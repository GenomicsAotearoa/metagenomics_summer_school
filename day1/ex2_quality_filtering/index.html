
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="Genomics Aotearoa & NeSI">
      
      
        <link rel="canonical" href="https://genomicsaotearoa.github.io/metagenomics_summer_school/day1/ex2_quality_filtering/">
      
      
        <link rel="prev" href="../ex2_1_intro_to_scheduler/">
      
      
        <link rel="next" href="../ex3_assembly/">
      
      
      <link rel="icon" href="../../theme_images/nesi_ga.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.34">
    
    
      
        <title>Filter raw reads by quality - Metagenomics Summer School</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.35f28582.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Mukta:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Mukta";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
   <link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../../assets/javascripts/glightbox.min.js"></script></head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#filter-raw-reads-by-quality" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Metagenomics Summer School" class="md-header__button md-logo" aria-label="Metagenomics Summer School" data-md-component="logo">
      
  <img src="../../theme_images/nesi_ga.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Metagenomics Summer School
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Filter raw reads by quality
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/GenomicsAotearoa/metagenomics_summer_school" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GenomicsAotearoa/metagenomics_summer_school
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../ex1_bash_and_scheduler/" class="md-tabs__link">
          
  
  Day 1

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../day2/ex6_initial_binning/" class="md-tabs__link">
          
  
  Day 2

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../day3/ex11_coverage_and_taxonomy/" class="md-tabs__link">
          
  
  Day 3

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../day4/ex15_gene_annotation_part3/" class="md-tabs__link">
          
  
  Day 4

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../resources/1_APPENDIX_ex8_Dereplication/" class="md-tabs__link">
          
  
  Resources

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../supplementary/supplementary_1/" class="md-tabs__link">
          
  
  Supplementary

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Metagenomics Summer School" class="md-nav__button md-logo" aria-label="Metagenomics Summer School" data-md-component="logo">
      
  <img src="../../theme_images/nesi_ga.png" alt="logo">

    </a>
    Metagenomics Summer School
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/GenomicsAotearoa/metagenomics_summer_school" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GenomicsAotearoa/metagenomics_summer_school
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Day 1
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Day 1
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ex1_bash_and_scheduler/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction I: Shell
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ex2_1_intro_to_scheduler/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction II: HPC and job scheduler
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Filter raw reads by quality
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Filter raw reads by quality
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#visualising-raw-reads" class="md-nav__link">
    <span class="md-ellipsis">
      Visualising raw reads
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Visualising raw reads">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#loading-fastqc" class="md-nav__link">
    <span class="md-ellipsis">
      Loading FastQC
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-fastqc" class="md-nav__link">
    <span class="md-ellipsis">
      Running FastQC
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#viewing-the-outputs-from-fastqc" class="md-nav__link">
    <span class="md-ellipsis">
      Viewing the outputs from FastQC
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fastqc-outputs-for-libraries-with-errors" class="md-nav__link">
    <span class="md-ellipsis">
      FastQC outputs for libraries with errors
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#combining-fastqc-outputs-using-multiqc" class="md-nav__link">
    <span class="md-ellipsis">
      Combining FastQC outputs using MultiQC
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#read-trimming-and-adapter-removal-with-trimmomatic" class="md-nav__link">
    <span class="md-ellipsis">
      Read trimming and adapter removal with trimmomatic
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Read trimming and adapter removal with trimmomatic">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#working-with-the-illuminaclip-command" class="md-nav__link">
    <span class="md-ellipsis">
      Working with the ILLUMINACLIP command
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#considerations-when-working-with-trimmomatic" class="md-nav__link">
    <span class="md-ellipsis">
      Considerations when working with trimmomatic
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#diagnosing-poor-libraries" class="md-nav__link">
    <span class="md-ellipsis">
      Diagnosing poor libraries
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#understanding-common-issues-and-best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      Understanding common issues and best practices
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#filtering-out-host-dna" class="md-nav__link">
    <span class="md-ellipsis">
      Filtering out host DNA
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Filtering out host DNA">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-masked-human-reference-genome" class="md-nav__link">
    <span class="md-ellipsis">
      The masked human reference genome
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#indexing-the-reference-genome-and-read-mapping-with-bbmap" class="md-nav__link">
    <span class="md-ellipsis">
      Indexing the reference genome and read mapping with BBMap
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ex3_assembly/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Assembly I: Assembling contigs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ex4_assembly/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Assembly II: Varying the parameters
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ex5_evaluating_assemblies/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Assembly evaluation
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Day 2
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Day 2
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../day2/ex6_initial_binning/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction to binning
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../day2/ex7_initial_binning/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Binning with multiple tools
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../day2/ex8_bin_dereplication/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Bin dereplication
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../day2/ex9_refining_bins/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Manual bin refinement
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../day2/ex10.1_viruses/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Identifying viral contigs in metagenomic data
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Day 3
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Day 3
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../day3/ex11_coverage_and_taxonomy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Assigning taxonomy to refined prokaryotic bins
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../day3/ex11.1_phylogenomics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Phylogenomics
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../day3/ex10.2_viruses/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Virus taxonomy
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../day3/ex12_gene_prediction/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Gene prediction
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../day3/ex13_gene_annotation_part1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Gene annotation I: BLAST-like and HMM
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../day3/ex14_gene_annotation_part2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Gene annotation II: DRAM and coverage calculation
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Day 4
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Day 4
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../day4/ex15_gene_annotation_part3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Gene annotation III: DRAM distillation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../day4/ex16a_data_presentation_Intro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction to data presentation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../day4/ex16b_data_presentation_Coverage/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Coverage heatmaps
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../day4/ex16c_OPTIONAL_data_presentation_Ordination/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ordinations
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../day4/ex16d_data_presentation_KEGG_pathways/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    KEGG pathway maps
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../day4/ex16e_data_presentation_Gene_synteny/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Gene synteny
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../day4/ex16f_OPTIONAL_data_presentation_CAZy_annotations/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CAZy heatmaps
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Resources
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Resources
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../resources/1_APPENDIX_ex8_Dereplication/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    APPENDIX (ex8): Dereplicating data from multiple assemblies
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../resources/2_APPENDIX_ex9_Generating_input_files_for_VizBin/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    APPENDIX (ex9): Generating input files for VizBin from DAS_Tool curated bins
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../resources/3_APPENDIX_ex11_Normalise_coverage_example/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    APPENDIX (ex11): Normalise per-sample coverage values by average library size (example)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../resources/4_APPENDIX_ex11_viral_taxonomy_prediction_via_vContact2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    APPENDIX (ex11) : Viral taxonomy prediction via vContact2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../resources/7_command_line_shortcuts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Useful command line shortcuts
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Supplementary
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Supplementary
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../supplementary/supplementary_1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NeSI Setup
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../supplementary/supplementary_2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NeSI File system, Working directory and Symlinks
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#visualising-raw-reads" class="md-nav__link">
    <span class="md-ellipsis">
      Visualising raw reads
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Visualising raw reads">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#loading-fastqc" class="md-nav__link">
    <span class="md-ellipsis">
      Loading FastQC
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-fastqc" class="md-nav__link">
    <span class="md-ellipsis">
      Running FastQC
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#viewing-the-outputs-from-fastqc" class="md-nav__link">
    <span class="md-ellipsis">
      Viewing the outputs from FastQC
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fastqc-outputs-for-libraries-with-errors" class="md-nav__link">
    <span class="md-ellipsis">
      FastQC outputs for libraries with errors
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#combining-fastqc-outputs-using-multiqc" class="md-nav__link">
    <span class="md-ellipsis">
      Combining FastQC outputs using MultiQC
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#read-trimming-and-adapter-removal-with-trimmomatic" class="md-nav__link">
    <span class="md-ellipsis">
      Read trimming and adapter removal with trimmomatic
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Read trimming and adapter removal with trimmomatic">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#working-with-the-illuminaclip-command" class="md-nav__link">
    <span class="md-ellipsis">
      Working with the ILLUMINACLIP command
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#considerations-when-working-with-trimmomatic" class="md-nav__link">
    <span class="md-ellipsis">
      Considerations when working with trimmomatic
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#diagnosing-poor-libraries" class="md-nav__link">
    <span class="md-ellipsis">
      Diagnosing poor libraries
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#understanding-common-issues-and-best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      Understanding common issues and best practices
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#filtering-out-host-dna" class="md-nav__link">
    <span class="md-ellipsis">
      Filtering out host DNA
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Filtering out host DNA">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-masked-human-reference-genome" class="md-nav__link">
    <span class="md-ellipsis">
      The masked human reference genome
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#indexing-the-reference-genome-and-read-mapping-with-bbmap" class="md-nav__link">
    <span class="md-ellipsis">
      Indexing the reference genome and read mapping with BBMap
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="filter-raw-reads-by-quality">Filter raw reads by quality<a class="headerlink" href="#filter-raw-reads-by-quality" title="Permanent link">&para;</a></h1>
<div class="admonition info">
<p class="admonition-title">Objectives</p>
<ul>
<li><a href="#visualising-raw-reads">Visualising raw reads with <code>FastQC</code></a></li>
<li><a href="#read-trimming-and-adapter-removal-with-trimmomatic">Read trimming and adapter removal with <code>trimmomatic</code></a></li>
<li><a href="#diagnosing-poor-libraries">Diagnosing poor libraries</a></li>
<li><a href="#understanding-common-issues-and-best-practices">Understand common issues and best practices</a></li>
<li><a href="#filtering-out-host-dna">Filtering out host DNA with <code>BBMap</code></a></li>
</ul>
</div>
<p><center>
<a class="glightbox" href="../../theme_images/qc_image.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image" src="../../theme_images/qc_image.png" width="350" /></a>
</center></p>
<hr />
<h2 id="visualising-raw-reads">Visualising raw reads<a class="headerlink" href="#visualising-raw-reads" title="Permanent link">&para;</a></h2>
<p><code>FastQC</code> is an extremely popular tool for checking your sequencing libraries, as the visual interface makes it easy to identify the following issues:</p>
<ol>
<li>Adapter/barcode sequences</li>
<li>Low quality regions of sequence</li>
<li>Quality drop-off towards the end of read-pair sequence</li>
</ol>
<h3 id="loading-fastqc">Loading <code>FastQC</code><a class="headerlink" href="#loading-fastqc" title="Permanent link">&para;</a></h3>
<p>These exercises will take place in the <code>2.fastqc/</code> directory. First, navigate to this directory. Copy the command below into your terminal (logged in to NeSI), replacing <code>&lt;YOUR FOLDER&gt;</code>, and then running the command.</p>
<div class="admonition terminal-2">
<p class="admonition-title">Navigate to our working directory</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nb">cd</span><span class="w"> </span>/nesi/nobackup/nesi02659/MGSS_U/&lt;YOUR<span class="w"> </span>FOLDER&gt;/2.fastqc/
</code></pre></div>
</div>
<div class="admonition terminal-2">
<p class="admonition-title">To activate <code>FastQC</code> on NeSI, you need to first load the module using the command</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>module<span class="w"> </span>purge
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>module<span class="w"> </span>load<span class="w"> </span>FastQC/0.12.1
</code></pre></div>
</div>
<h3 id="running-fastqc">Running <code>FastQC</code><a class="headerlink" href="#running-fastqc" title="Permanent link">&para;</a></h3>
<div class="admonition terminal-2">
<p class="admonition-title">We will run <code>FastQC</code> from the command line as follows:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>fastqc<span class="w"> </span>mock_R1.good.fastq.gz<span class="w"> </span>mock_R2.good.fastq.gz
</code></pre></div>
</div>
<h3 id="viewing-the-outputs-from-fastqc">Viewing the outputs from <code>FastQC</code><a class="headerlink" href="#viewing-the-outputs-from-fastqc" title="Permanent link">&para;</a></h3>
<p><code>FastQC</code> generates output reports in <code>.html</code> files that can be viewed in a standard web browser. </p>
<p>Fortunately, if you're currently using the terminal within <code>Jupyter hub</code> for today's session, we can open the <code>.html</code> files directly from here:</p>
<ul>
<li>Click on the directory icon in the top left to open the directory navigator pane (if not already open).</li>
<li>The default viewed location will be the overall project that you have logged in to (in this case, the 'Genomics Aotearoa Virtual Lab Training Access (nesi02659)' project). </li>
<li>Click through <code>MGSS_U</code>, into your directory, and then into the <code>2.fastqc/</code> directory. </li>
<li>Double click on the output <code>...fastqc.html</code> files to open them in the a new tab within the <code>Jupyter hub</code>.</li>
</ul>
<p>Examples of the output files are also available for download <a href="../../resources/fastqc_results.zip">here</a>.</p>
<p>Note that <code>FastQC</code> does not load the forward and reverse pairs of a library in the same window, so you need to be mindful of how your samples relate to each other. </p>
<p><a class="glightbox" href="../../figures/ex3_fig1_overview.PNG" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image" src="../../figures/ex3_fig1_overview.PNG" /></a></p>
<p>At a first glance, we can see the follow statistics:</p>
<ol>
<li>The data is stored in Sanger / Illumina 1.9 encoding. <em>This will be important to remember when read trimming.</em></li>
<li>There are 100,000 reads in the file</li>
<li>The maximum sequence length is 251 base pairs. <em>This is good to check, since the data were generated using Illumina 2x250 bp sequencing.</em></li>
</ol>
<p>Have a quick look through the menu sidebar on the left. As you can see, the data has passed most of the basic parameters.</p>
<div class="admonition success">
<div class="tabbed-set tabbed-alternate" data-tabs="1:3"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><input id="__tabbed_1_3" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">Per-base sequence quality</label><label for="__tabbed_1_2">Per sequence GC content</label><label for="__tabbed_1_3">Adapter Content</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p><a class="glightbox" href="../../figures/ex3_fig2_quality.PNG" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image" src="../../figures/ex3_fig2_quality.PNG" /></a></p>
</div>
<div class="tabbed-block">
<p><a class="glightbox" href="../../figures/ex3_fig5_gc.PNG" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image" src="../../figures/ex3_fig5_gc.PNG" /></a></p>
</div>
<div class="tabbed-block">
<p><a class="glightbox" href="../../figures/ex3_fig4_adapter.PNG" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image" src="../../figures/ex3_fig4_adapter.PNG" /></a></p>
</div>
</div>
</div>
</div>
<p>The only aspect of the data that <code>FastQC</code> is flagging as potentially problematic is the GC% content of the data set. This observation is expected as we deal with a mixed community and organisms. Therefore, it is unlikely that there will be a perfect normal distribution around an average value. For example, a community comprised of low- and high-GC organisms would manifest a bimodal distribution of peaks which would be a problematic outcome in terms of the expectations of <code>FastQC</code>, but completely consistent with the biology of the system.</p>
<h3 id="fastqc-outputs-for-libraries-with-errors"><code>FastQC</code> outputs for libraries with errors<a class="headerlink" href="#fastqc-outputs-for-libraries-with-errors" title="Permanent link">&para;</a></h3>
<p>Lets take a look at a library with significant errors. Process the sequence file <code>mock_R1.adapter_decay.fastq</code> with <code>FastQC</code>.</p>
<div class="admonition terminal">
<p class="admonition-title">code</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>fastqc<span class="w"> </span>mock_R1.adapter_decay.fastq.gz
</code></pre></div>
</div>
<p>Compare the results with the <code>mock_R1.good.fastq.gz</code> file.</p>
<p>Which of the previous fields we examined are now flagged as problematic? How does this compare with your expectation? Are there any which should be flagged which are not?</p>
<div class="admonition success">
<div class="tabbed-set tabbed-alternate" data-tabs="2:2"><input checked="checked" id="__tabbed_2_1" name="__tabbed_2" type="radio" /><input id="__tabbed_2_2" name="__tabbed_2" type="radio" /><div class="tabbed-labels"><label for="__tabbed_2_1">Per-base sequence quality</label><label for="__tabbed_2_2">Adapter content</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p><a class="glightbox" href="../../figures/ex3_fig6_taildecay.PNG" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image" src="../../figures/ex3_fig6_taildecay.PNG" /></a></p>
</div>
<div class="tabbed-block">
<p><a class="glightbox" href="../../figures/ex3_fig10_bad_adapter.PNG" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image" src="../../figures/ex3_fig10_bad_adapter.PNG" /></a></p>
</div>
</div>
</div>
</div>
<hr />
<h3 id="combining-fastqc-outputs-using-multiqc">Combining <code>FastQC</code> outputs using <code>MultiQC</code><a class="headerlink" href="#combining-fastqc-outputs-using-multiqc" title="Permanent link">&para;</a></h3>
<p>In this workshop, there are only few <code>fastq</code> files to work with. However, for an actual metagenomics experiment/survey, there might be 100s of files to QC. Here, we can use <code>MultiQC</code> to aggregate all of the reports generated by <code>FastQC</code> into one HTML file. </p>
<div class="admonition terminal">
<p class="admonition-title">code</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>module<span class="w"> </span>load<span class="w"> </span>MultiQC/1.13-gimkl-2022a-Python-3.10.5
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>multiqc<span class="w"> </span>./
</code></pre></div>
</div>
<p>In the command above, MultiQC is directed to look for relevant files in the current directory and produce a browser-friendly HTML report there.</p>
<h2 id="read-trimming-and-adapter-removal-with-trimmomatic">Read trimming and adapter removal with <em>trimmomatic</em><a class="headerlink" href="#read-trimming-and-adapter-removal-with-trimmomatic" title="Permanent link">&para;</a></h2>
<p><center>
<a class="glightbox" href="../../theme_images/cleaning_reads.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image" src="../../theme_images/cleaning_reads.png" width="300" /></a>
</center></p>
<p>There are a multitude of programs which can be used to quality trim sequence data and remove adapter sequence. For this exercise we are going to use <code>trimmomatic</code>, but this should in no way be interpreted as an endorsement of <code>trimmomatic</code> over equivalent tools like <code>BBMap</code>, <code>sickle</code>, <code>cutadapt</code> or any other.</p>
<div class="admonition terminal-2">
<p class="admonition-title">For a first run with <code>trimmomatic</code>, type the following commands into your console:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>module<span class="w"> </span>load<span class="w"> </span>Trimmomatic/0.39-Java-1.8.0_144
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="c1"># Run Trimmomatic</span>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>trimmomatic<span class="w"> </span>PE<span class="w"> </span>-threads<span class="w"> </span><span class="m">4</span><span class="w"> </span>-phred33<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="w">               </span>mock_R1.adapter_decay.fastq.gz<span class="w"> </span>mock_R2.adapter_decay.fastq.gz<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="w">               </span>mock_R1.qc.fastq.gz<span class="w"> </span>mock_s1.qc.fastq.gz<span class="w"> </span>mock_R2.qc.fastq.gz<span class="w"> </span>mock_s2.qc.fastq.gz<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span class="w">               </span>ILLUMINACLIP:NexteraPE-PE.fa:1:25:7<span class="w"> </span>SLIDINGWINDOW:4:30<span class="w"> </span>MINLEN:80
</code></pre></div>
</div>
<p>There is a lot going on in this command, so here is a breakdown of the parameters in the command above</p>
<div class="admonition info">
<table>
<thead>
<tr>
<th style="text-align: left;">Parameter</th>
<th style="text-align: center;">Type</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><code>PE</code></td>
<td style="text-align: center;"><em>positional</em></td>
<td style="text-align: left;">Specifies whether we are analysing single- or paired-end reads</td>
</tr>
<tr>
<td style="text-align: left;"><code>-threads 2</code></td>
<td style="text-align: center;"><em>keyword</em></td>
<td style="text-align: left;">Specifies the number of threads to use when processing</td>
</tr>
<tr>
<td style="text-align: left;"><code>-phred33</code></td>
<td style="text-align: center;"><em>keyword</em></td>
<td style="text-align: left;">Specifies the fastq encoding used</td>
</tr>
<tr>
<td style="text-align: left;"><code>mock_R1.adapter_decay.fastq.gz</code> / <code>mock_R2.adapter_decay.fastq.gz</code></td>
<td style="text-align: center;"><em>positional</em></td>
<td style="text-align: left;">The paired forward and reverse reads to trim</td>
</tr>
<tr>
<td style="text-align: left;"><code>mock_R1.qc.fastq.gz</code></td>
<td style="text-align: center;"><em>positional</em></td>
<td style="text-align: left;">The file to write forward reads which passed quality trimming, if their reverse partner also passed</td>
</tr>
<tr>
<td style="text-align: left;"><code>mock_s1.qc.fastq.gz</code></td>
<td style="text-align: center;"><em>positional</em></td>
<td style="text-align: left;">The file to write forward reads which passed quality trimming, if their reverse partner failed (orphan reads)</td>
</tr>
<tr>
<td style="text-align: left;"><code>mock_R2.qc.fastq.gz</code> / <code>mock_s2.qc.fastq.gz</code></td>
<td style="text-align: center;"><em>positional</em></td>
<td style="text-align: left;">The reverse-sequence equivalent of above</td>
</tr>
<tr>
<td style="text-align: left;"><code>ILLUMINACLIP:NexteraPE-PE.fa:1:25:7</code></td>
<td style="text-align: center;"><em>positional</em></td>
<td style="text-align: left;">Adapter trimming allowing for 1 seed mismatch, palindrome clip score threshold of 25, and simple clip score threshold of 7</td>
</tr>
<tr>
<td style="text-align: left;"><code>SLIDINGWINDOW:4:30</code></td>
<td style="text-align: center;"><em>positional</em></td>
<td style="text-align: left;">Quality filtering command. Analyse each sequence in a 4 base pair sliding window and then truncate if the average quality drops below Q30</td>
</tr>
<tr>
<td style="text-align: left;"><code>MINLEN:80</code></td>
<td style="text-align: center;"><em>positional</em></td>
<td style="text-align: left;">Length filtering command. Discard sequences that are shorter than 80 base pairs after trimming</td>
</tr>
</tbody>
</table>
</div>
<div class="admonition circle-check">
<p class="admonition-title">Terminal output</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>TrimmomaticPE: Started with arguments:
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a> -threads 4 -phred33 mock_R1.adapter_decay.fastq.gz mock_R2.adapter_decay.fastq.gz mock_R1.qc.fastq.gz mock_s1.qc.fastq.gz mock_R2.qc.fastq.gz mock_s2.qc.fastq.gz ILLUMINACLIP:NexteraPE-PE.fa:1:25:7 SLIDINGWINDOW:4:30 MINLEN:80
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>Using PrefixPair: &#39;AGATGTGTATAAGAGACAG&#39; and &#39;AGATGTGTATAAGAGACAG&#39;
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>Using Long Clipping Sequence: &#39;GTCTCGTGGGCTCGGAGATGTGTATAAGAGACAG&#39;
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>Using Long Clipping Sequence: &#39;TCGTCGGCAGCGTCAGATGTGTATAAGAGACAG&#39;
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>Using Long Clipping Sequence: &#39;CTGTCTCTTATACACATCTCCGAGCCCACGAGAC&#39;
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>Using Long Clipping Sequence: &#39;CTGTCTCTTATACACATCTGACGCTGCCGACGA&#39;
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a>ILLUMINACLIP: Using 1 prefix pairs, 4 forward/reverse sequences, 0 forward only sequences, 0 reverse only sequences
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a>Input Read Pairs: 2000000 Both Surviving: 1160013 (58.00%) Forward Only Surviving: 340638 (17.03%) Reverse Only Surviving: 124184 (6.21%) Dropped: 375165 (18.76%)
<a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a>TrimmomaticPE: Completed successfully
</code></pre></div>
</div>
<p>After Trimmomatic has completed, run FastQC again to check how well your reads have done.</p>
<h3 id="working-with-the-illuminaclip-command">Working with the <code>ILLUMINACLIP</code> command<a class="headerlink" href="#working-with-the-illuminaclip-command" title="Permanent link">&para;</a></h3>
<p>Adapter trimming in <code>Trimmomatic</code> is called via the <code>ILLUMINACLIP</code> command, which can be used to pass a FASTA file of adapter and barcode sequences to be found and removed from your data. For further information about the <code>ILLUMINACLIP</code> command, please refer to the <code>trimmomatic</code> <a href="http://www.usadellab.org/cms/uploads/supplementary/Trimmomatic/TrimmomaticManual_V0.32.pdf">manual</a> for a detailed description.</p>
<p>There is always some subjectivity in how sensitive you want your adapter (and barcode) searching to be. If the settings are too strict you might end up discarding real sequence data that only partially overlaps with the Illumina adapters. If your settings are not strict enough then you might leave partial adapters in the sequence. For short inserts (DNA fragments), the sequencing process can read through into the adapter on the other side (3'), thus <strong>adapters need to be removed <em>prior</em> to quality-based trimming</strong> as the chance of hitting adapters (thus, removing them) is highest when the sequence is longer.</p>
<p>Running the trimmed files back through <code>FastQC</code>, we can see that this significantly improves the output.</p>
<div class="admonition success">
<div class="tabbed-set tabbed-alternate" data-tabs="3:2"><input checked="checked" id="__tabbed_3_1" name="__tabbed_3" type="radio" /><input id="__tabbed_3_2" name="__tabbed_3" type="radio" /><div class="tabbed-labels"><label for="__tabbed_3_1">Quality of reads for trimmed R1</label><label for="__tabbed_3_2">Adapter content for trimmed R1</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p><a class="glightbox" href="../../figures/ex3_fig7_qualtrim.PNG" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image" src="../../figures/ex3_fig7_qualtrim.PNG" /></a></p>
</div>
<div class="tabbed-block">
<p><a class="glightbox" href="../../figures/ex3_fig9_adaptertrimmed.PNG" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image" src="../../figures/ex3_fig9_adaptertrimmed.PNG" /></a></p>
</div>
</div>
</div>
</div>
<hr />
<h3 id="considerations-when-working-with-trimmomatic">Considerations when working with <code>trimmomatic</code><a class="headerlink" href="#considerations-when-working-with-trimmomatic" title="Permanent link">&para;</a></h3>
<p><strong>Order of operations</strong></p>
<p>The basic format for a <code>trimmomatic</code> command is</p>
<div class="admonition terminal">
<p class="admonition-title">code</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>trimmomatic<span class="w"> </span>PE<span class="w"> </span>&lt;keyword<span class="w"> </span>flags&gt;<span class="w"> </span>&lt;sequence<span class="w"> </span>input&gt;<span class="w"> </span>&lt;sequence<span class="w"> </span>output&gt;<span class="w"> </span>&lt;trimming<span class="w"> </span>parameters&gt;
</code></pre></div>
</div>
<p>The trimming parameters are processed in the order you specify them. This is a deliberate behaviour, but can have some unexpected consequences for new users.</p>
<p>For example, consider these two scenarios:</p>
<div class="admonition terminal">
<p class="admonition-title">code</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="c1"># Command 1</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>trimmomatic<span class="w"> </span>PE<span class="w"> </span>&lt;keyword<span class="w"> </span>flags&gt;<span class="w"> </span>&lt;sequence<span class="w"> </span>input&gt;<span class="w"> </span>&lt;sequence<span class="w"> </span>output&gt;<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="w">                </span>ILLUMINACLIP:<span class="si">${</span><span class="nv">adapter</span><span class="si">}</span>:1:25:7<span class="w"> </span>SLIDINGWINDOW:4:30<span class="w"> </span>MINLEN:80
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="c1"># Command 2</span>
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>trimmomatic<span class="w"> </span>PE<span class="w"> </span>&lt;keyword<span class="w"> </span>flags&gt;<span class="w"> </span>&lt;sequence<span class="w"> </span>input&gt;<span class="w"> </span>&lt;sequence<span class="w"> </span>output&gt;<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="w">                </span>ILLUMINACLIP:<span class="si">${</span><span class="nv">adapter</span><span class="si">}</span>:1:25:7<span class="w"> </span>MINLEN:80<span class="w"> </span>SLIDINGWINDOW:4:30
</code></pre></div>
</div>
<p>In the first run, we would not expect any sequence shorter than 80 base pairs to exist in the output files. However, we might encounter them in the second command. This is because in the second command we remove sequences shorter than 80 base pairs, <strong><em>then</em></strong> perform quality trimming. If a sequence is trimmed to a length shorter than 80 base pairs <strong><em>after</em></strong> trimming, the <code>MINLEN</code> filtering does not execute a second time. In the first instance, we do not perform trimming <strong><em>before</em></strong> size selection, so any reads that start longer than 80 base pairs, but are trimmed to under 80 base pairs during quality trimming will be caught in the <code>MINLEN</code> run.</p>
<hr />
<h2 id="diagnosing-poor-libraries">Diagnosing poor libraries<a class="headerlink" href="#diagnosing-poor-libraries" title="Permanent link">&para;</a></h2>
<p>Whether a library is 'poor' quality or not can be a bit subjective. These are some aspects of the library that you should be looking for when evaluating <code>FastQC</code>:</p>
<div class="admonition note">
<ol>
<li>Does the sequencing length match what you ordered from the facility?</li>
<li>If the sequences are shorter than expected, is adapter read-through a concern?</li>
<li>What does the sequence quality look like for the whole length of the run? Are there any expected/unexpected regions of quality degradation?</li>
<li>Are adapters and/or barcodes removed? <ul>
<li>Look at the <em>Per base sequence content</em> to diagnose this.</li>
</ul>
</li>
<li>Is there unexpected sequence duplication? <ul>
<li>This can occur when low-input library preparations are used.</li>
</ul>
</li>
<li>Are over-represented <em>k</em>-mers present? <ul>
<li>This can be a sign of adapter and barcode contamination.</li>
</ul>
</li>
</ol>
</div>
<hr />
<h2 id="understanding-common-issues-and-best-practices">Understanding common issues and best practices<a class="headerlink" href="#understanding-common-issues-and-best-practices" title="Permanent link">&para;</a></h2>
<div class="admonition success">
<ol>
<li>Do I need to remove (rare) adapters?</li>
<li>I don’t know if adapters have been removed or not</li>
<li>How do I identify and remove adapter read-through?</li>
<li>Identifying incomplete barcode/adapter removal</li>
<li>Over aggressive trimming</li>
<li>GC skew is outside of expected range</li>
</ol>
</div>
<hr />
<h2 id="filtering-out-host-dna">Filtering out host DNA<a class="headerlink" href="#filtering-out-host-dna" title="Permanent link">&para;</a></h2>
<p>Metagenome data derived from host-associated microbial communities should ideally be filtered to remove any reads originating from host DNA. This may improve the quality and efficiency of downstream data processing (since we will no longer be processing a bunch of data that we are likely not interested in), and is also an important consideration when working with metagenomes that may include data of a sensitive nature (and which may also need to be removed prior to making the data publicly available). This is especially important for any studies involving human subjects or those involving samples derived from Taonga species.</p>
<p>There are several approaches that can be used to achieve this. The general principle is to map your reads to a reference genome (e.g. human genome) and remove those reads that map to the reference from the dataset. </p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This process may be more complicated if a reference genome for your host taxa is not readily available. In this case an alternative method would need to be employed (for example: predicting taxonomy via <code>Kraken2</code> and then filtering out all reads that map to the phylum or kingdom of your host taxa).</p>
</div>
<p>This exercise provides an example using <code>BBMap</code> to map against a masked human reference genome and retain only those reads that do <em>not</em> map to the reference. Here we are mapping some mock human microbiome reads against a pre-prepared human genome that has been processed to mask sections of the genome, including those that:</p>
<ul>
<li>are presumed microbial contaminant in the reference</li>
<li>have high homology to microbial genes/genomes (e.g. ribosomes)</li>
<li>those that are of low complexity </li>
</ul>
<p>This ensures that reads that would normally map to these sections of the human genome are <em>not</em> removed from the dataset (as genuine microbial reads that we wish to retain might also map to these regions), while all reads mapping to the rest of the human genome are removed.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The same process can be used to remove DNA matching other hosts (e.g. mouse), however you would need to search if anyone has prepared (and made available) a masked version of the reference genome, or create a masked version using <code>bbmask</code>. The creator of BBMap has made available masked human, mouse, cat, and dog genomes. More information, including links to these references and instructions on how to generate a masked genome for other taxa, can be found within <a href="http://seqanswers.com/forums/showthread.php?t=42552">this thread</a>.*</p>
</div>
<h3 id="the-masked-human-reference-genome">The masked human reference genome<a class="headerlink" href="#the-masked-human-reference-genome" title="Permanent link">&para;</a></h3>
<p>The masked reference genome is available via <a href="https://drive.google.com/file/d/0B3llHR93L14wd0pSSnFULUlhcUk/edit?usp=sharing">Google drive</a> and <a href="https://zenodo.org/record/1208052">Zenodo</a>. For this workshop, we have provided you with the file within the <code>2.fastqc/BBMask_human_reference/</code> directory.</p>
<details class="note">
<summary>Downloading your own copy of the masked genome</summary>
<p>We can use <code>gdown</code> to download this file from Google drive via the command line.</p>
<p>To install <code>gdown</code>, we can use <code>pip</code>. </p>
<div class="admonition terminal-2">
<p class="admonition-title">Install <code>gdown</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="c1"># Install gdown (for downloading from google drive)</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>module<span class="w"> </span>purge
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>module<span class="w"> </span>load<span class="w"> </span>Python/3.10.5-gimkl-2022a
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>pip<span class="w"> </span>install<span class="w"> </span>--user<span class="w"> </span>gdown
</code></pre></div>
</div>
<p>Next, download the reference. It will also be necessary to first add your local <code>bin</code> location to the <code>PATH</code> variable via the <code>export PATH=...</code> command, as this is where <code>gdown</code> is located (modify <code>&lt;your_username&gt;</code> before running the code below).</p>
<div class="admonition terminal-2">
<p class="admonition-title">Download reference</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>mkdir<span class="w"> </span>BBMask_human_reference/
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="nb">cd</span><span class="w"> </span>BBMask_human_reference/
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="nb">export</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span><span class="s2">&quot;/home/&lt;your_username&gt;/.local/bin:</span><span class="nv">$PATH</span><span class="s2">&quot;</span>
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a>
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a>gdown<span class="w"> </span>https://drive.google.com/uc?id<span class="o">=</span>0B3llHR93L14wd0pSSnFULUlhcUk
</code></pre></div>
</div>
</details>
<h3 id="indexing-the-reference-genome-and-read-mapping-with-bbmap">Indexing the reference genome and read mapping with <code>BBMap</code><a class="headerlink" href="#indexing-the-reference-genome-and-read-mapping-with-bbmap" title="Permanent link">&para;</a></h3>
<p>We will cover more about read mapping in <a href="https://genomicsaotearoa.github.io/metagenomics_summer_school/day2/ex6_initial_binning/">later exercises</a>. For now, it is important to know that it is first necessary to build an index of the reference using the read mapping tool of choice. Here, we will first build a <code>BBMap</code> index, and then use <code>BBMap</code> to map the reads to that index, ultimately retaining only those reads that do <em>not</em> map to the index.</p>
<p>Build index reference via <code>BBMap</code>. We will do this by submitting the job via slurm. </p>
<p>Create a new script named <code>host_filt_bbmap_index.sl</code> using <code>nano</code>:</p>
<div class="admonition terminal">
<p class="admonition-title">code</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>nano<span class="w"> </span>host_filt_bbmap_index.sl
</code></pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Remember to update <code>&lt;YOUR FOLDER&gt;</code> to your own folder</p>
</div>
<div class="admonition terminal">
<p class="admonition-title">code</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-12-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-12-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-12-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-12-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-12-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-12-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-12-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-12-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-12-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-12-10">10</a></span>
<span class="normal"><a href="#__codelineno-12-11">11</a></span>
<span class="normal"><a href="#__codelineno-12-12">12</a></span>
<span class="normal"><a href="#__codelineno-12-13">13</a></span>
<span class="normal"><a href="#__codelineno-12-14">14</a></span>
<span class="normal"><a href="#__codelineno-12-15">15</a></span>
<span class="normal"><a href="#__codelineno-12-16">16</a></span>
<span class="normal"><a href="#__codelineno-12-17">17</a></span>
<span class="normal"><a href="#__codelineno-12-18">18</a></span>
<span class="normal"><a href="#__codelineno-12-19">19</a></span>
<span class="normal"><a href="#__codelineno-12-20">20</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1"></a><span class="ch">#!/bin/bash -e</span>
<a id="__codelineno-12-2" name="__codelineno-12-2"></a>
<a id="__codelineno-12-3" name="__codelineno-12-3"></a><span class="c1">#SBATCH --account       nesi02659</span>
<a id="__codelineno-12-4" name="__codelineno-12-4"></a><span class="c1">#SBATCH --job-name      host_filt_bbmap_index</span>
<a id="__codelineno-12-5" name="__codelineno-12-5"></a><span class="c1">#SBATCH --partition     milan</span>
<a id="__codelineno-12-6" name="__codelineno-12-6"></a><span class="c1">#SBATCH --time          00:20:00</span>
<a id="__codelineno-12-7" name="__codelineno-12-7"></a><span class="c1">#SBATCH --mem           32GB</span>
<a id="__codelineno-12-8" name="__codelineno-12-8"></a><span class="c1">#SBATCH --cpus-per-task 12</span>
<a id="__codelineno-12-9" name="__codelineno-12-9"></a><span class="c1">#SBATCH --error         %x_%j.err</span>
<a id="__codelineno-12-10" name="__codelineno-12-10"></a><span class="c1">#SBATCH --output        %x_%j.out</span>
<a id="__codelineno-12-11" name="__codelineno-12-11"></a>
<a id="__codelineno-12-12" name="__codelineno-12-12"></a><span class="c1"># Working directory</span>
<a id="__codelineno-12-13" name="__codelineno-12-13"></a><span class="nb">cd</span><span class="w"> </span>/nesi/nobackup/nesi02659/MGSS_U/&lt;YOUR<span class="w"> </span>FOLDER&gt;/2.fastqc/BBMask_human_reference/
<a id="__codelineno-12-14" name="__codelineno-12-14"></a>
<a id="__codelineno-12-15" name="__codelineno-12-15"></a><span class="c1"># Load BBMap module</span>
<a id="__codelineno-12-16" name="__codelineno-12-16"></a>module<span class="w"> </span>purge
<a id="__codelineno-12-17" name="__codelineno-12-17"></a>module<span class="w"> </span>load<span class="w"> </span>BBMap/39.01-GCC-11.3.0
<a id="__codelineno-12-18" name="__codelineno-12-18"></a>
<a id="__codelineno-12-19" name="__codelineno-12-19"></a><span class="c1"># Build indexed reference file via BBMap</span>
<a id="__codelineno-12-20" name="__codelineno-12-20"></a>bbmap.sh<span class="w"> </span><span class="nv">ref</span><span class="o">=</span>hg19_main_mask_ribo_animal_allplant_allfungus.fa.gz
</code></pre></div></td></tr></table></div>
</div>
<p>Save your script by pressing <kbd>Ctrl</kbd> + <kbd>o</kbd> , then exit the editor by pressing <kbd>Ctrl</kbd> + <kbd>x</kbd> .</p>
<p>Submit your newly created script to the scheduler as follows:</p>
<div class="admonition terminal">
<p class="admonition-title">code</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>sbatch<span class="w"> </span>host_filt_bbmap_index.sl
</code></pre></div>
</div>
<p>Finally, map the reads to the reference via <code>BBMap</code>. Here we will submit the job as a slurm array, with one array job per sample. </p>
<p>Again, we will create a script using <code>nano</code>: </p>
<div class="admonition terminal">
<p class="admonition-title">code</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>nano<span class="w"> </span>host_filt_bbmap_map.sl
</code></pre></div>
</div>
<div class="admonition terminal">
<p class="admonition-title">code</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-15-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-15-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-15-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-15-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-15-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-15-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-15-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-15-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-15-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-15-10">10</a></span>
<span class="normal"><a href="#__codelineno-15-11">11</a></span>
<span class="normal"><a href="#__codelineno-15-12">12</a></span>
<span class="normal"><a href="#__codelineno-15-13">13</a></span>
<span class="normal"><a href="#__codelineno-15-14">14</a></span>
<span class="normal"><a href="#__codelineno-15-15">15</a></span>
<span class="normal"><a href="#__codelineno-15-16">16</a></span>
<span class="normal"><a href="#__codelineno-15-17">17</a></span>
<span class="normal"><a href="#__codelineno-15-18">18</a></span>
<span class="normal"><a href="#__codelineno-15-19">19</a></span>
<span class="normal"><a href="#__codelineno-15-20">20</a></span>
<span class="normal"><a href="#__codelineno-15-21">21</a></span>
<span class="normal"><a href="#__codelineno-15-22">22</a></span>
<span class="normal"><a href="#__codelineno-15-23">23</a></span>
<span class="normal"><a href="#__codelineno-15-24">24</a></span>
<span class="normal"><a href="#__codelineno-15-25">25</a></span>
<span class="normal"><a href="#__codelineno-15-26">26</a></span>
<span class="normal"><a href="#__codelineno-15-27">27</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1"></a><span class="ch">#!/bin/bash -e</span>
<a id="__codelineno-15-2" name="__codelineno-15-2"></a>
<a id="__codelineno-15-3" name="__codelineno-15-3"></a><span class="c1">#SBATCH --account       nesi02659</span>
<a id="__codelineno-15-4" name="__codelineno-15-4"></a><span class="c1">#SBATCH --job-name      host_filt_bbmap_map</span>
<a id="__codelineno-15-5" name="__codelineno-15-5"></a><span class="c1">#SBATCH --partition     milan</span>
<a id="__codelineno-15-6" name="__codelineno-15-6"></a><span class="c1">#SBATCH --time          01:00:00</span>
<a id="__codelineno-15-7" name="__codelineno-15-7"></a><span class="c1">#SBATCH --mem           27GB</span>
<a id="__codelineno-15-8" name="__codelineno-15-8"></a><span class="c1">#SBATCH --cpus-per-task 20</span>
<a id="__codelineno-15-9" name="__codelineno-15-9"></a><span class="c1">#SBATCH --error         %x_%j.err</span>
<a id="__codelineno-15-10" name="__codelineno-15-10"></a><span class="c1">#SBATCH --output        %x_%j.out</span>
<a id="__codelineno-15-11" name="__codelineno-15-11"></a>
<a id="__codelineno-15-12" name="__codelineno-15-12"></a><span class="c1"># Set up working directories</span>
<a id="__codelineno-15-13" name="__codelineno-15-13"></a><span class="nb">cd</span><span class="w"> </span>/nesi/nobackup/nesi02659/MGSS_U/&lt;YOUR<span class="w"> </span>FOLDER&gt;/2.fastqc/
<a id="__codelineno-15-14" name="__codelineno-15-14"></a>mkdir<span class="w"> </span>-p<span class="w"> </span>host_filtered_reads/
<a id="__codelineno-15-15" name="__codelineno-15-15"></a>
<a id="__codelineno-15-16" name="__codelineno-15-16"></a><span class="c1"># Load BBMap module</span>
<a id="__codelineno-15-17" name="__codelineno-15-17"></a>module<span class="w"> </span>purge
<a id="__codelineno-15-18" name="__codelineno-15-18"></a>module<span class="w"> </span>load<span class="w"> </span>BBMap/39.01-GCC-11.3.0
<a id="__codelineno-15-19" name="__codelineno-15-19"></a>
<a id="__codelineno-15-20" name="__codelineno-15-20"></a><span class="c1"># Run bbmap</span>
<a id="__codelineno-15-21" name="__codelineno-15-21"></a>bbmap.sh<span class="w"> </span>-Xmx27g<span class="w"> </span>-t<span class="o">=</span><span class="m">12</span><span class="w"> </span><span class="nv">usejni</span><span class="o">=</span>t<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-15-22" name="__codelineno-15-22"></a><span class="w">  </span><span class="nv">minid</span><span class="o">=</span><span class="m">0</span>.95<span class="w"> </span><span class="nv">maxindel</span><span class="o">=</span><span class="m">3</span><span class="w"> </span><span class="nv">bwr</span><span class="o">=</span><span class="m">0</span>.16<span class="w"> </span><span class="nv">bw</span><span class="o">=</span><span class="m">12</span><span class="w"> </span>quickmatch<span class="w"> </span>fast<span class="w"> </span><span class="nv">minhits</span><span class="o">=</span><span class="m">2</span><span class="w"> </span><span class="nv">qtrim</span><span class="o">=</span>rl<span class="w"> </span><span class="nv">trimq</span><span class="o">=</span><span class="m">10</span><span class="w"> </span>untrim<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-15-23" name="__codelineno-15-23"></a><span class="w">  </span><span class="nv">in1</span><span class="o">=</span>human_microb_reads.R1.fastq.gz<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-15-24" name="__codelineno-15-24"></a><span class="w">  </span><span class="nv">in2</span><span class="o">=</span>human_microb_reads.R2.fastq.gz<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-15-25" name="__codelineno-15-25"></a><span class="w">  </span><span class="nv">path</span><span class="o">=</span>BBMask_human_reference/<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-15-26" name="__codelineno-15-26"></a><span class="w">  </span><span class="nv">outu1</span><span class="o">=</span>host_filt_R1.fastq<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-15-27" name="__codelineno-15-27"></a><span class="w">  </span><span class="nv">outu2</span><span class="o">=</span>host_filt_R2.fastq
</code></pre></div></td></tr></table></div>
</div>
<div class="admonition abstract">
<p class="admonition-title"><code>BBMap</code> parameters</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><code>-Xmx27g</code></td>
<td style="text-align: left;">Set maximum memory allocation to match <code>#SBATCH --mem</code>)</td>
</tr>
<tr>
<td style="text-align: left;"><code>-t</code></td>
<td style="text-align: left;">Set number of threads (CPUs) to match <code>#SBATCH --cpus-per-task</code></td>
</tr>
<tr>
<td style="text-align: left;">All flags in line 22</td>
<td style="text-align: left;">Recommended parameters found within <a href="http://seqanswers.com/forums/showthread.php?t=42552">this thread</a> about processing data to remove host reads</td>
</tr>
<tr>
<td style="text-align: left;"><code>in1</code> / <code>in2</code></td>
<td style="text-align: left;">Input paired-end reads 1 and 2 stored in <code>3.assembly/</code>, each of which are "samples". These are the same files we will use in further lessons</td>
</tr>
<tr>
<td style="text-align: left;"><code>path</code></td>
<td style="text-align: left;">The parent directory where <code>ref/</code> (our indexed and masked reference) exists</td>
</tr>
<tr>
<td style="text-align: left;"><code>outu1</code> / <code>outu2</code></td>
<td style="text-align: left;">Reads that <em>were not mapped</em> to our masked reference written to <code>host_filtered_reads/</code></td>
</tr>
</tbody>
</table>
</div>
<p>We'll submit the mapping script:</p>
<div class="admonition terminal">
<p class="admonition-title">code</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>sbatch<span class="w"> </span>host_filt_bbmap_map.sl
</code></pre></div>
</div>
<details class="tip">
<summary>Monitoring job progress</summary>
<p>We can monitor our job progress using <code>squeue --me</code> or <code>sacct &lt;job_id&gt;</code>. This will be covered in detail as part of the main content when we <a href="../ex5_evaluating_assemblies/#evaluating-the-resource-consumption-of-various-assemblies">evaluate assemblies</a>. </p>
</details>
<div class="admonition note">
<p class="admonition-title">Array jobs</p>
<p>Slurm array jobs automatically create a variable <code>SLURM_ARRAY_TASK_ID</code> for that job, which contains the array task number (i.e. between 1 and 4 in the case above). We use this to run the command on the sample that matches this array task ID. I.e. array job 3 will run the commands on "sample3" (<code>sample${SLURM_ARRAY_TASK_ID}</code> is read in as <code>sample3</code>).</p>
</div>
<p>The filtered reads are now available in <code>host_filtered_reads/</code> for downstream use.</p>
<hr />












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tracking", "navigation.sections", "navigation.expand", "navigation.top", "navigation.tabs", "navigation.tabs.sticky", "content.code.copy", "content.code.annotate"], "search": "../../assets/javascripts/workers/search.07f07601.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.56dfad97.min.js"></script>
      
        <script src="../../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  <script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body>
</html>