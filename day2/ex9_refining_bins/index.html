
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="Genomics Aotearoa & NeSI">
      
      
        <link rel="canonical" href="https://genomicsaotearoa.github.io/metagenomics_summer_school/day2/ex9_refining_bins/">
      
      
        <link rel="prev" href="../ex8_bin_dereplication/">
      
      
        <link rel="next" href="../ex10.1_viruses/">
      
      
      <link rel="icon" href="../../theme_images/nesi_ga.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.34">
    
    
      
        <title>Manual bin refinement - Metagenomics Summer School</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.35f28582.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Mukta:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Mukta";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
   <link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../../assets/javascripts/glightbox.min.js"></script></head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#manual-bin-refinement" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Metagenomics Summer School" class="md-header__button md-logo" aria-label="Metagenomics Summer School" data-md-component="logo">
      
  <img src="../../theme_images/nesi_ga.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Metagenomics Summer School
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Manual bin refinement
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/GenomicsAotearoa/metagenomics_summer_school" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GenomicsAotearoa/metagenomics_summer_school
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../day1/ex1_bash_and_scheduler/" class="md-tabs__link">
          
  
  Day 1

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../ex6_initial_binning/" class="md-tabs__link">
          
  
  Day 2

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../day3/ex11_coverage_and_taxonomy/" class="md-tabs__link">
          
  
  Day 3

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../day4/ex15_gene_annotation_part3/" class="md-tabs__link">
          
  
  Day 4

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../resources/1_APPENDIX_ex8_Dereplication/" class="md-tabs__link">
          
  
  Resources

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../supplementary/supplementary_1/" class="md-tabs__link">
          
  
  Supplementary

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Metagenomics Summer School" class="md-nav__button md-logo" aria-label="Metagenomics Summer School" data-md-component="logo">
      
  <img src="../../theme_images/nesi_ga.png" alt="logo">

    </a>
    Metagenomics Summer School
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/GenomicsAotearoa/metagenomics_summer_school" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GenomicsAotearoa/metagenomics_summer_school
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Day 1
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Day 1
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../day1/ex1_bash_and_scheduler/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction I: Shell
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../day1/ex2_1_intro_to_scheduler/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction II: HPC and job scheduler
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../day1/ex2_quality_filtering/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Filter raw reads by quality
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../day1/ex3_assembly/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Assembly I: Assembling contigs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../day1/ex4_assembly/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Assembly II: Varying the parameters
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../day1/ex5_evaluating_assemblies/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Assembly evaluation
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Day 2
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Day 2
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ex6_initial_binning/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction to binning
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ex7_initial_binning/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Binning with multiple tools
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ex8_bin_dereplication/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Bin dereplication
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Manual bin refinement
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Manual bin refinement
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#preparing-input-files-for-vizbin" class="md-nav__link">
    <span class="md-ellipsis">
      Preparing input files for VizBin
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#projecting-a-t-sne-and-examining-bin-clusters" class="md-nav__link">
    <span class="md-ellipsis">
      Projecting a t-SNE and examining bin clusters
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Projecting a t-SNE and examining bin clusters">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#initiate-vizbin-within-the-virtual-desktop-environment" class="md-nav__link">
    <span class="md-ellipsis">
      Initiate VizBin within the Virtual Desktop environment
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#load-input-files" class="md-nav__link">
    <span class="md-ellipsis">
      Load input files
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#executing-the-t-sne" class="md-nav__link">
    <span class="md-ellipsis">
      Executing the t-SNE
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#contigs-coloured-by-bin" class="md-nav__link">
    <span class="md-ellipsis">
      Contigs coloured by bin
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-picking-and-exporting-sequences" class="md-nav__link">
    <span class="md-ellipsis">
      1. Picking and exporting sequences
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. Picking and exporting sequences">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#highlight-a-cluster-to-zoom-into" class="md-nav__link">
    <span class="md-ellipsis">
      Highlight a cluster to zoom into
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#select-the-cluster-to-export" class="md-nav__link">
    <span class="md-ellipsis">
      Select the cluster to export
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#export-the-cluster" class="md-nav__link">
    <span class="md-ellipsis">
      Export the cluster
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-refining-bins" class="md-nav__link">
    <span class="md-ellipsis">
      2. Refining bins
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. Refining bins">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#inspect-the-genome-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      Inspect the genome metrics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prepare-output-directory" class="md-nav__link">
    <span class="md-ellipsis">
      Prepare output directory
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#load-the-files-into-vizbin" class="md-nav__link">
    <span class="md-ellipsis">
      Load the files into VizBin
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#export-clusters" class="md-nav__link">
    <span class="md-ellipsis">
      Export clusters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#check-distribution-of-contig-fragments" class="md-nav__link">
    <span class="md-ellipsis">
      Check distribution of contig fragments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#remove-problematic-contigs" class="md-nav__link">
    <span class="md-ellipsis">
      Remove problematic contigs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#form-new-bins" class="md-nav__link">
    <span class="md-ellipsis">
      Form new bins
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#check-your-new-bins" class="md-nav__link">
    <span class="md-ellipsis">
      Check your new bins!
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#human-refinement-vs-automated-binning" class="md-nav__link">
    <span class="md-ellipsis">
      Human refinement vs automated binning
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ex10.1_viruses/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Identifying viral contigs in metagenomic data
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Day 3
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Day 3
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../day3/ex11_coverage_and_taxonomy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Assigning taxonomy to refined prokaryotic bins
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../day3/ex11.1_phylogenomics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Phylogenomics
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../day3/ex10.2_viruses/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Virus taxonomy
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../day3/ex12_gene_prediction/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Gene prediction
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../day3/ex13_gene_annotation_part1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Gene annotation I: BLAST-like and HMM
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../day3/ex14_gene_annotation_part2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Gene annotation II: DRAM and coverage calculation
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Day 4
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Day 4
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../day4/ex15_gene_annotation_part3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Gene annotation III: DRAM distillation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../day4/ex16a_data_presentation_Intro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction to data presentation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../day4/ex16b_data_presentation_Coverage/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Coverage heatmaps
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../day4/ex16c_OPTIONAL_data_presentation_Ordination/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ordinations
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../day4/ex16d_data_presentation_KEGG_pathways/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    KEGG pathway maps
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../day4/ex16e_data_presentation_Gene_synteny/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Gene synteny
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../day4/ex16f_OPTIONAL_data_presentation_CAZy_annotations/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CAZy heatmaps
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Resources
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Resources
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../resources/1_APPENDIX_ex8_Dereplication/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    APPENDIX (ex8): Dereplicating data from multiple assemblies
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../resources/2_APPENDIX_ex9_Generating_input_files_for_VizBin/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    APPENDIX (ex9): Generating input files for VizBin from DAS_Tool curated bins
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../resources/3_APPENDIX_ex11_Normalise_coverage_example/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    APPENDIX (ex11): Normalise per-sample coverage values by average library size (example)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../resources/4_APPENDIX_ex11_viral_taxonomy_prediction_via_vContact2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    APPENDIX (ex11) : Viral taxonomy prediction via vContact2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../resources/7_command_line_shortcuts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Useful command line shortcuts
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Supplementary
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Supplementary
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../supplementary/supplementary_1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NeSI Setup
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../supplementary/supplementary_2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NeSI File system, Working directory and Symlinks
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#preparing-input-files-for-vizbin" class="md-nav__link">
    <span class="md-ellipsis">
      Preparing input files for VizBin
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#projecting-a-t-sne-and-examining-bin-clusters" class="md-nav__link">
    <span class="md-ellipsis">
      Projecting a t-SNE and examining bin clusters
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Projecting a t-SNE and examining bin clusters">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#initiate-vizbin-within-the-virtual-desktop-environment" class="md-nav__link">
    <span class="md-ellipsis">
      Initiate VizBin within the Virtual Desktop environment
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#load-input-files" class="md-nav__link">
    <span class="md-ellipsis">
      Load input files
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#executing-the-t-sne" class="md-nav__link">
    <span class="md-ellipsis">
      Executing the t-SNE
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#contigs-coloured-by-bin" class="md-nav__link">
    <span class="md-ellipsis">
      Contigs coloured by bin
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-picking-and-exporting-sequences" class="md-nav__link">
    <span class="md-ellipsis">
      1. Picking and exporting sequences
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. Picking and exporting sequences">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#highlight-a-cluster-to-zoom-into" class="md-nav__link">
    <span class="md-ellipsis">
      Highlight a cluster to zoom into
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#select-the-cluster-to-export" class="md-nav__link">
    <span class="md-ellipsis">
      Select the cluster to export
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#export-the-cluster" class="md-nav__link">
    <span class="md-ellipsis">
      Export the cluster
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-refining-bins" class="md-nav__link">
    <span class="md-ellipsis">
      2. Refining bins
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. Refining bins">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#inspect-the-genome-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      Inspect the genome metrics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prepare-output-directory" class="md-nav__link">
    <span class="md-ellipsis">
      Prepare output directory
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#load-the-files-into-vizbin" class="md-nav__link">
    <span class="md-ellipsis">
      Load the files into VizBin
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#export-clusters" class="md-nav__link">
    <span class="md-ellipsis">
      Export clusters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#check-distribution-of-contig-fragments" class="md-nav__link">
    <span class="md-ellipsis">
      Check distribution of contig fragments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#remove-problematic-contigs" class="md-nav__link">
    <span class="md-ellipsis">
      Remove problematic contigs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#form-new-bins" class="md-nav__link">
    <span class="md-ellipsis">
      Form new bins
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#check-your-new-bins" class="md-nav__link">
    <span class="md-ellipsis">
      Check your new bins!
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#human-refinement-vs-automated-binning" class="md-nav__link">
    <span class="md-ellipsis">
      Human refinement vs automated binning
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="manual-bin-refinement">Manual bin refinement<a class="headerlink" href="#manual-bin-refinement" title="Permanent link">&para;</a></h1>
<div class="admonition info">
<p class="admonition-title">Objectives</p>
<ul>
<li><a href="#preparing-input-files-for-vizbin">Preparing input files for <code>VizBin</code></a></li>
<li><a href="#projecting-a-t-sne-and-examining-bin-clusters">Projecting a <em>t-SNE</em> using <code>VizBin</code> and examining bin clusters</a></li>
<li><a href="#1-picking-and-exporting-sequences">Picking and exporting sequences</a></li>
<li><a href="#2-refining-bins">Refining bins</a></li>
</ul>
</div>
<hr />
<h2 id="preparing-input-files-for-vizbin">Preparing input files for <code>VizBin</code><a class="headerlink" href="#preparing-input-files-for-vizbin" title="Permanent link">&para;</a></h2>
<div class="admonition quote">
<p class="admonition-title">What is <code>VizBin</code>?</p>
<p><a href="http://claczny.github.io/VizBin/"><code>VizBin</code></a> is a handy, GUI-based tool for creating ordinations of our binning data using the <a href="https://lvdmaaten.github.io/tsne/">t-Distributed Stochastic Neighbor Embedding (t-SNE)</a> algorithm to project high-dimensional data down into a 2D plot that preserves clustering information. There's a really good video on <a href="https://www.youtube.com/watch?v=NEaUSP4YerM">YouTube</a> that explains how the algorithm works in high-level terms, but for our purposes you can really consider it as a similar approach to a PCA or NMDS.</p>
<p>On its own, <code>VizBin</code> takes a set of contigs and performs the <em>t-SNE</em> projection using compositional data. We can optionally provide it files that annotate contigs as belonging to particular bins and a file that adds coverage data to be considered when clustering. Unfortuantely, at this stage <code>VizBin</code> only allows a single coverage value per contig, which is not ideal. This is because <code>VizBin</code> only uses coverage as a means to modify the visualisation, not the ordination itself. It is possible to create your own <em>t-SNE</em> projection using multiple coverage values, however this is beyond the scope of today's exercise, and here we will be providing <code>VizBin</code> with coverage values for sample1 only. </p>
<p>The only required input file for <code>VizBin</code> is a single <em>.fna</em> file of the concatenated bins. An additional annotation file containing per-contig coverage values and bin IDs can also be provided. Colouring contigs by bin is a really effective way to spot areas that might need refinement.</p>
<p>In the interests of time today, the input files have been generated and are provided in the <code>6.bin_refinement/</code> folder: </p>
<ul>
<li><code>all_fragments.fna</code> is a concatenation of the bins of <em>fragmented</em> sub-contigs (fragmented to 20k)</li>
<li><code>all_fragments.sample1.vizbin.ann</code> is the annotation file containing per-subcontig coverage, label (bin ID), and length values.</li>
</ul>
</div>
<div class="admonition note">
<p class="admonition-title">Contig fragments as input for <code>VizBin</code></p>
<p>When running <code>VizBin</code>, it is often preferable to split long contigs into smaller pieces in order to increase the density of clustering in the <strong>t-SNE</strong>. The data we are working with today are based on our bins output by <code>DAS_Tool</code> in the last binning exercise, but have been further processed using the <code>cut_up_fasta.py</code> script that comes with the binning tool <code>CONCOCT</code> to cut long contigs into 20k fragments. When reviewing our <code>VizBin</code> plots and outputs, it is important to remember that here we are looking at the <strong>fragmented sub-contigs</strong>, rather than the full complete contigs.</p>
</div>
<p>For future reference, and for working with your own data, a step-by-step process for generating these files from the dereplicated bins generated by <code>DAS_Tool</code> has been provided as an <a href="../../resources/2_APPENDIX_ex9_Generating_input_files_for_VizBin/">Appendix</a>.</p>
<p>For this section, we will be working within <code>6.bin_refinement/</code>. Let's first have a quick look at the annotation file.</p>
<div class="admonition terminal-2">
<p class="admonition-title">Navigate to working directory</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="c1"># Navigate to correct directory</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="nb">cd</span><span class="w"> </span>/nesi/nobackup/nesi02659/MGSS_U/&lt;YOUR<span class="w"> </span>FOLDER&gt;/6.bin_refinement
</code></pre></div>
</div>
<div class="admonition terminal-2">
<p class="admonition-title">Inspect <code>all_bins.sample1.vizbin.ann</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>head<span class="w"> </span>-n<span class="w"> </span><span class="m">5</span><span class="w"> </span>all_fragments.sample1.vizbin.ann
</code></pre></div>
</div>
<div class="admonition circle-check">
<p class="admonition-title">Terminal output</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>coverage,label,length
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>17.6626,bin_0.chopped,20000
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>15.9561,bin_0.chopped,20000
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>17.294,bin_0.chopped,20000
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>15.8157,bin_0.chopped,20000
</code></pre></div>
</div>
<p>This file is a comma-delimited table (csv file) that presents the information in the way that <code>VizBin</code> expects it. The order of rows in this file corresponds to the order of contigs in the concatenated FASTA file of our fragmented bins, <code>all_fragments.fna</code>.</p>
<p>Create a few variations of the <em>.ann</em> file with various columns removed, in order to examine the different outputs they can generate.</p>
<div class="admonition terminal">
<p class="admonition-title">code</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">Bin ID only</label><label for="__tabbed_1_2">Bin ID and coverage without length</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>cut<span class="w"> </span>-f2<span class="w"> </span>-d<span class="w"> </span><span class="s1">&#39;,&#39;</span><span class="w"> </span>all_fragments.sample1.vizbin.ann<span class="w"> </span>&gt;<span class="w"> </span>all_fragments.sample1.vizbin.bin_only.ann
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>cut<span class="w"> </span>-f1,2<span class="w"> </span>-d<span class="w"> </span><span class="s1">&#39;,&#39;</span><span class="w"> </span>all_fragments.sample1.vizbin.ann<span class="w"> </span>&gt;<span class="w"> </span>all_fragments.sample1.vizbin.no_length.ann
</code></pre></div>
</div>
</div>
</div>
</div>
<div class="admonition hint">
<p class="admonition-title">Symbolic links for easy access</p>
<p>By default, <code>VizBin</code> redirects to your home directory. To make it easy to come back to our working directory, we can make a symbolic link (aka shortcut) that points to here from home.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>ln<span class="w"> </span>-sr<span class="w"> </span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span><span class="w"> </span>~/
</code></pre></div>
<p>The flags mean:</p>
<ul>
<li><code>-s</code> designates it as a symbolic, instead of hard link</li>
<li><code>-r</code> indicates that paths are relative</li>
</ul>
</div>
<hr />
<h2 id="projecting-a-t-sne-and-examining-bin-clusters">Projecting a <em>t-SNE</em> and examining bin clusters<a class="headerlink" href="#projecting-a-t-sne-and-examining-bin-clusters" title="Permanent link">&para;</a></h2>
<p>We can now use these files in <code>VizBin</code> to curate the contigs in our bins. We will load and view the data in a few different steps.</p>
<p>For this exercise, we will be using the <em>Virtual Desktop</em> on NeSI which allows us to use programmes with graphical user interfaces (GUI) within the NeSI computing environment.</p>
<div class="admonition jupyter">
<p class="admonition-title">Initiate the Virtual Desktop</p>
<ol>
<li>Click on <kbd>File</kbd> on the top left corner of the Jupyter Hub, and then select <kbd>New Launcher</kbd>. You can also click on the small <kbd>+</kbd> on the tabbed bar next to your terminal tab.</li>
<li>Look for the Virtual Desktop icon and then click on centre of the icon.
    <center>
    <a class="glightbox" href="../../figures/VirtualDesktop.PNG" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="virtual desktop icon" src="../../figures/VirtualDesktop.PNG" /></a>
    </center></li>
<li>A new browser tab named 'TurboVNC:...' should appear and the Virtual Desktop should load.</li>
<li>A successful instance of the Virtual Desktop should look like a desktop environment.</li>
</ol>
<p><center>
<a class="glightbox" href="../../figures/VirtualDesktopInitiated.PNG" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="virtual desktop environment" src="../../figures/VirtualDesktopInitiated.PNG" width="600px" /></a>
</center></p>
</div>
<div class="admonition note">
<p class="admonition-title">Running <code>VizBin</code>: local vs remote</p>
<p>Running <code>VizBin</code> remotely (e.g. within NeSI) can be slow with full data sets. Running a GUI (such as a program like <code>VizBin</code>) remotely can also require additional set up on some PCs. For day-to-day work, we recommend installing <code>VizBin</code> on your local machine and downloading the relevant input files (e.g. via <code>scp ...</code>) to run locally.</p>
</div>
<!--

`VizBin` cannot be opened within the NeSI `Jupyter hub`. For today's exercise, open `VizBin` via either:

**A. Install and run `VizBin` locally**

* Download `VizBin-dist.jar` from [here](https://github.com/claczny/VizBin/releases/tag/v1.0.0)
* You may also need to [install Java locally](https://www.java.com/en/download/manual.jsp) (choose the relevant version for your machine).
* Download the required files from NeSI to your machine (via `scp`, or right-click > download, from within the `Jupyter hub`), or download the example files from [this link](../resources/vizbin_files.zip).
* Double-click `VizBin-dist.jar` to open `VizBin`, and then follow the steps below.

**OR**

**B. Log in via a standard terminal.** 

* Log into NeSI via a standard terminal (*not* the terminal within `Jupyter hub`) and run the following command (*NOTE: this may return an error if X11 forwarding is not set up for your machine. In this case, proceed with the first option above*).

<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="nb">cd</span><span class="w"> </span>/nesi/nobackup/nesi02659/MGSS_U/&lt;YOUR<span class="w"> </span>FOLDER&gt;/6.bin_refinement/
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>java<span class="w"> </span>-jar<span class="w"> </span>../tools/vizbin.jar
</code></pre></div>

If this fails to open on your PC, or if it runs prohibitively slowly, team up with 2-3 others in the workshop to run through this exercise together on one machine.

-->

<h3 id="initiate-vizbin-within-the-virtual-desktop-environment">Initiate <code>VizBin</code> within the Virtual Desktop environment<a class="headerlink" href="#initiate-vizbin-within-the-virtual-desktop-environment" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p>In the Virtual Desktop, click on the terminal icon.
    <center>
    <a class="glightbox" href="../../figures/TerminalEmulator.PNG" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="terminal emulator" src="../../figures/TerminalEmulator.PNG" /></a>
    </center></p>
</li>
<li>
<p><code>VizBin</code> is a Java programme, therefore we will need to load the Java module for it to work. In the terminal, type the following to load the Java module</p>
<div class="admonition warning">
<p class="admonition-title">Copy/paste in the Virtual Desktop</p>
<p>You will not be able to copy text from outside the Virtual Desktop and paste into the Virtual Desktop, in which case you will need to manually type these commands.</p>
</div>
<div class="admonition terminal">
<p class="admonition-title">code</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>module<span class="w"> </span>load<span class="w"> </span>Java/20.0.2
</code></pre></div>
</div>
</li>
<li>
<p>In the terminal, navigate to your directory where the Java file resides</p>
<div class="admonition warning">
<p class="admonition-title">Remember to replace <code>YOUR FOLDER</code> with your user name.</p>
</div>
<div class="admonition terminal">
<p class="admonition-title">code</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="nb">cd</span><span class="w"> </span>/nesi/nobackup/nesi02659/MGSS_U/&lt;YOUR<span class="w"> </span>FOLDER&gt;/6.bin_refinement/
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>ls
</code></pre></div>
</div>
<div class="admonition circle-check">
<p class="admonition-title">Terminal output</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>all_fragments.fna                 example_data_unchopped  mock_fragments.fna
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>all_fragments.sample1.vizbin.ann  mock_bins               mock_fragments.sample3.vizbin.bin_only.ann
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>example_data_20k                  mock_bins_checkm_out    vizbin_count_table.sh
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>example_data_20k_cov.txt          mock_bins.checkm.txt    VizBin-dist.jar
</code></pre></div>
</div>
</li>
<li>
<p>Type the following into your Virtual Desktop terminal to initiate VizBin.</p>
<div class="admonition terminal">
<p class="admonition-title">code</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>java<span class="w"> </span>-jar<span class="w"> </span>VizBin-dist.jar
</code></pre></div>
</div>
</li>
<li>
<p>A successful launch of <code>VizBin</code> will look like the following:
   <center>
   <a class="glightbox" href="../../figures/SucessVizBin-2024.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="vizbin launch" src="../../figures/SucessVizBin-2024.png" width="600" /></a>
   </center></p>
</li>
</ol>
<h3 id="load-input-files">Load input files<a class="headerlink" href="#load-input-files" title="Permanent link">&para;</a></h3>
<p>Once <code>VizBin</code> is open, to get started, click the 'Choose...' button then navigate to the FASTA file <code>all_fragments.fna</code>.</p>
<div class="admonition tip">
<p class="admonition-title"><code>VizBin</code> directory</p>
<p>It is likely that when we click on the 'Choose...' button, the directory that is open will be our NeSI home directory. In that case, we can type in the input FASTA file in the 'File Name' bar: <code>/nesi/nobackup/nesi02659/MGSS_U/&lt;YOUR FOLDER&gt;/6.bin_refinement/all_fragments.fna</code></p>
</div>
<p><center><a class="glightbox" href="../../figures/ex10_load_fasta_2024.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image" src="../../figures/ex10_load_fasta_2024.png" /></a></center></p>
<p>Once this is imported, use the 'Show additional options' button to expose the advanced options, and add your <strong>'bin only'</strong> <em>.ann</em> file into the 'Annotation file (optional)' field.</p>
<p><center><a class="glightbox" href="../../figures/ex10_load_ann_2024.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image" src="../../figures/ex10_load_ann_2024.png" /></a></center></p>
<h3 id="executing-the-t-sne">Executing the <em>t-SNE</em><a class="headerlink" href="#executing-the-t-sne" title="Permanent link">&para;</a></h3>
<p>For now leave all other parameters as default. Click the 'Start' button to begin building the ordination. When it completes, you should see an output similar to the following:</p>
<h3 id="contigs-coloured-by-bin">Contigs coloured by bin<a class="headerlink" href="#contigs-coloured-by-bin" title="Permanent link">&para;</a></h3>
<p><center><a class="glightbox" href="../../figures/ex10_bin_only_2024.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image" src="../../figures/ex10_bin_only_2024.png" width="600" /></a></center></p>
<details class="note">
<summary>Additional annotations by length and coverage</summary>
<p>If you input <code>all_bins.sample1.vizbin.ann</code> as your annotation file, you can see that the visualisation takes contig length (represented by point size) and coverage (represented by opacity) into account.</p>
<p><center>
<a class="glightbox" href="../../figures/ex10_all_ann_2022.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image" src="../../figures/ex10_all_ann_2022.png" /></a>
</center></p>
</details>
<p>Similar to other projection techniques, we interpret the closeness of points as a proxy for how similar they are, and because of our <em>.ann</em> file we can see which contigs belong to the same bin.</p>
<div class="admonition question">
<p class="admonition-title">What do scaffolds look like?</p>
<p>In the example above, we used fragmented scaffolds as input files for VizBin. Take a look at what scaffolds look like with VizBin. Run the following code to generate input files for VizBin to visualise scaffolds.</p>
<div class="admonition terminal">
<p class="admonition-title">code</p>
</div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-11-1">1</a></span>
<span class="normal"><a href="#__codelineno-11-2">2</a></span>
<span class="normal"><a href="#__codelineno-11-3">3</a></span>
<span class="normal"><a href="#__codelineno-11-4">4</a></span>
<span class="normal"><a href="#__codelineno-11-5">5</a></span>
<span class="normal"><a href="#__codelineno-11-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;label&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>all_scaffolds.vizbin.ann
<a id="__codelineno-11-2" name="__codelineno-11-2"></a><span class="k">for</span><span class="w"> </span>fasta<span class="w"> </span><span class="k">in</span><span class="w"> </span>example_data_unchopped/*.fna<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<a id="__codelineno-11-3" name="__codelineno-11-3"></a><span class="w">    </span><span class="nv">bin</span><span class="o">=</span><span class="k">$(</span>basename<span class="w"> </span><span class="si">${</span><span class="nv">fasta</span><span class="si">}</span><span class="w"> </span>.fna<span class="k">)</span>
<a id="__codelineno-11-4" name="__codelineno-11-4"></a><span class="w">    </span>cat<span class="w"> </span><span class="si">${</span><span class="nv">fasta</span><span class="si">}</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>all_scaffolds.fna
<a id="__codelineno-11-5" name="__codelineno-11-5"></a><span class="w">    </span>grep<span class="w"> </span><span class="s1">&#39;&gt;&#39;</span><span class="w"> </span><span class="si">${</span><span class="nv">fasta</span><span class="si">}</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sed<span class="w"> </span><span class="s2">&quot;s/.*/</span><span class="si">${</span><span class="nv">bin</span><span class="si">}</span><span class="s2">/g&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>all_scaffolds.vizbin.ann
<a id="__codelineno-11-6" name="__codelineno-11-6"></a><span class="k">done</span>
</code></pre></div></td></tr></table></div>
<p>Import the newly generated <code>all_scaffolds.fna</code> and <code>all_scaffolds.vizbin.ann</code> into VizBin to visualise it.</p>
</div>
<hr />
<h2 id="1-picking-and-exporting-sequences">1. Picking and exporting sequences<a class="headerlink" href="#1-picking-and-exporting-sequences" title="Permanent link">&para;</a></h2>
<p>We can use the interactive GUI to pick the boundaries of new bins, or to identify contigs which we do not believe should be retained in the data. Have a play around with the interface, testing out the following commands:</p>
<ol>
<li>Left-click and drag: Highlight an area of the ordination to zoom into</li>
<li>Right-click, 'Zoom Out', 'Both Axes': Rest of the view</li>
<li>Left-click several points: Create a selection of contigs to extract from the data</li>
<li>Right-click, 'Selection', 'Export': Save the selected contigs into a new file</li>
<li>Right-click, 'Selection', 'Clear selection': Clear the current selection</li>
</ol>
<p>How you proceed in this stage is up to you. You can either select bins based on their boundary, and call these the refined bins. Alternatively, you could select outlier contigs and examine these in more detail to determine whether or not they were correctly placed into the bin. Which way you proceed really depends on how well the ordination resolves your bins, and it might be that both approaches are needed.</p>
<!--
Today, we will run through an example of selecting potentially problematic (sub)contigs, and then deciding whether or not we want to filter these contigs out of our refined bins. We can use a combination of `VizBin` and `seqmagick` to remove contigs from bins where we do not trust the placement of the contig. We are aiming to reduce each bin to a trusted set of contigs.

## 1. Export `VizBin` clusters
-->

<p>First, for each <code>VizBin</code> cluster, select the area around the cluster (via multiple left-clicks around the cluster), right-click, 'Selection', 'Export'. Save this output as <code>cluster_1.fna</code>. </p>
<p>Try this for one or two clusters. In practice, we would do this for each <code>VizBin</code> cluster, saving each as a new <code>cluster_n.fna</code> file.</p>
<h3 id="highlight-a-cluster-to-zoom-into">Highlight a cluster to zoom into<a class="headerlink" href="#highlight-a-cluster-to-zoom-into" title="Permanent link">&para;</a></h3>
<p><center>
<a class="glightbox" href="../../figures/ex10_select_to_zoom_2022.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image" src="../../figures/ex10_select_to_zoom_2022.png" width="600" /></a>
</center></p>
<h3 id="select-the-cluster-to-export">Select the cluster to export<a class="headerlink" href="#select-the-cluster-to-export" title="Permanent link">&para;</a></h3>
<p>Left-click several points around the cluster</p>
<p><center>
<a class="glightbox" href="../../figures/ex10_select_cluster_2022.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image" src="../../figures/ex10_select_cluster_2022.png" width="600" /></a>
</center></p>
<h3 id="export-the-cluster">Export the cluster<a class="headerlink" href="#export-the-cluster" title="Permanent link">&para;</a></h3>
<p>Right-click, 'Selection', 'Export'. Save the output as <code>cluster_1.fna</code>. </p>
<p><center>
<a class="glightbox" href="../../figures/ex10_export_2022.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image" src="../../figures/ex10_export_2022.png" width="600" /></a>
</center></p>
<h2 id="2-refining-bins">2. Refining bins<a class="headerlink" href="#2-refining-bins" title="Permanent link">&para;</a></h2>
<p>VizBin is a general purpose tool for contig/scaffold/fragment visualisation. For this workshop, we're going to attempt to refine a few bins. Refinement can mean reducing contamination, improving completeness and/or splitting strains. Here, we will:</p>
<ul>
<li>Diagnose and visualise contig fragments</li>
<li>Export clusters of contig fragments</li>
<li>Check distribution of contig fragments across clusters</li>
<li>Pull new contigs from concatenated bin files to form new bin clusters</li>
<li>Check if genome metrics improve after manual refinement</li>
</ul>
<p>For this exercise, we will be using data from the <code>mock_fragments*</code> files, <code>mock_bins/</code> sub-directory, and additional genome metrics in <code>mock_bins.checkm.txt</code>. These files were generated using a different assembly (reads assembled using MEGAHIT) based on a modified sample 3 library, and then binned using MetaBAT2 and MaxBin as per previous lessons.</p>
<h3 id="inspect-the-genome-metrics">Inspect the genome metrics<a class="headerlink" href="#inspect-the-genome-metrics" title="Permanent link">&para;</a></h3>
<p>Open up the file named <code>mock_bins.checkm.txt</code>. Take note of the metrics of each bin and consider what we might want to improve on.</p>
<h3 id="prepare-output-directory">Prepare output directory<a class="headerlink" href="#prepare-output-directory" title="Permanent link">&para;</a></h3>
<p>We also need to prepare an output directory for the clusters that we export.</p>
<div class="admonition terminal">
<p class="admonition-title">code</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-12-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1"></a>mkdir<span class="w"> </span>-p<span class="w"> </span>vb_export
</code></pre></div></td></tr></table></div>
</div>
<h3 id="load-the-files-into-vizbin">Load the files into VizBin<a class="headerlink" href="#load-the-files-into-vizbin" title="Permanent link">&para;</a></h3>
<p>Return to the VizBin set-up dialogue in the Virtual Desktop. Select the following input files:</p>
<p><strong>File to visualize:</strong> <code>mock_fragments.fna</code></p>
<p><strong>Annotation file:</strong> <code>mock_fragments.sample3.vizbin.bin_only.ann</code></p>
<p>Your VizBin will look like this:</p>
<p><a href="../../figures/ex10_mock_fragments.PNG">image</a></p>
<div class="admonition hint">
<p class="admonition-title">Legends</p>
<p>When you have projected the tSNE, you can show the bin identity by right-clicking anywhere on the ordination and then click "Legend". This will give you a box that shows you which contig belongs to which bin.</p>
</div>
<h3 id="export-clusters">Export clusters<a class="headerlink" href="#export-clusters" title="Permanent link">&para;</a></h3>
<p>Based on information you have on hand, make your selection around points that you think:</p>
<ul>
<li>Should form bins (name these sequences <code>cluster_n.bin_n.fa</code>, where <code>bin_n</code> reminds you which bin most of the fragments come from)</li>
<li>Are problematic fragments or fragments in doubt (name these sequences <code>contigs_n.fa</code>)</li>
</ul>
<div class="admonition tip">
<p class="admonition-title">You don't have to circle everything, just the ones you think need refining!</p>
</div>
<p>Export the sequences into the <code>vb_export/</code> directory we made earlier.</p>
<h3 id="check-distribution-of-contig-fragments">Check distribution of contig fragments<a class="headerlink" href="#check-distribution-of-contig-fragments" title="Permanent link">&para;</a></h3>
<p>We have provided you with a script that collects information from your exported fragments in order to check if you need to remove contigs from the aggregated <code>mock_fragments.fna</code>. We run this script like so:</p>
<div class="admonition terminal">
<p class="admonition-title">code</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-13-1">1</a></span>
<span class="normal"><a href="#__codelineno-13-2">2</a></span>
<span class="normal"><a href="#__codelineno-13-3">3</a></span>
<span class="normal"><a href="#__codelineno-13-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1"></a>./vizbin_count_table.sh<span class="w"> </span>-i<span class="w"> </span>vb_export/<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-13-2" name="__codelineno-13-2"></a><span class="w">                        </span>-e<span class="w"> </span>fa<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-13-3" name="__codelineno-13-3"></a><span class="w">                        </span>-c<span class="w"> </span>cluster<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-13-4" name="__codelineno-13-4"></a><span class="w">                        </span>-s<span class="w"> </span>contig
</code></pre></div></td></tr></table></div>
</div>
<div class="admonition note">
<p class="admonition-title"><code>vizbin_count_table.sh</code> flags</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Flags</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><code>-i</code></td>
<td style="text-align: left;">Input directory where FASTA files of drawn clusters are located</td>
</tr>
<tr>
<td style="text-align: left;"><code>-e</code></td>
<td style="text-align: left;">File extension for drawn clusters</td>
</tr>
<tr>
<td style="text-align: left;"><code>-c</code></td>
<td style="text-align: left;">File prefix for fragments that form new bins</td>
</tr>
<tr>
<td style="text-align: left;"><code>-s</code></td>
<td style="text-align: left;">File prefix for problematic fragments or whose placements are doubtful.</td>
</tr>
</tbody>
</table>
</div>
<p>The script counts how problematic fragments are distributed across different clusters (based on the contig they came from). This helps us make an informed decision if removing a contig from a cluster would impact other clusters.</p>
<p>The outputs are:</p>
<ul>
<li><code>vb_count_table.txt</code>: A table of fragments and where other fragments of the same contig are also distributed in different clusters.</li>
<li><code>vb_omit_contigs_tmp.txt</code>: A list of contigs (<em>not fragments</em>) that were designated as problematic to be removed.</li>
</ul>
<h3 id="remove-problematic-contigs">Remove problematic contigs<a class="headerlink" href="#remove-problematic-contigs" title="Permanent link">&para;</a></h3>
<p>If your <code>vb_count_table.txt</code> has fragments of a contig that are spread across different clusters, you may need to reconsider removing that contig (i.e., there are non-zero counts in multiple cluster columns). This is because removing them may impact the composition of other clusters. </p>
<p>Otherwise, if problematic contig fragments do not form clusters, we can simply ignore them when reforming new bins. In this exercise, it is highly unlikely you will encounter contig fragments shared across multiple clusters. As such, we will simply ignore the problematic contigs from the concatenated contigs file.</p>
<h3 id="form-new-bins">Form new bins<a class="headerlink" href="#form-new-bins" title="Permanent link">&para;</a></h3>
<p>Start by creating a new directory for refined bins.</p>
<div class="admonition terminal">
<p class="admonition-title">code</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>mkdir<span class="w"> </span>-p<span class="w"> </span>refined_bins/
</code></pre></div>
</div>
<p>We then create a file with the relevant contigs from our newly formed clusters.</p>
<div class="admonition terminal">
<p class="admonition-title">code</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="k">for</span><span class="w"> </span>cluster<span class="w"> </span><span class="k">in</span><span class="w"> </span>vb_export/cluster*.fa<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="w">    </span>grep<span class="w"> </span><span class="s1">&#39;&gt;&#39;</span><span class="w"> </span><span class="si">${</span><span class="nv">cluster</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="w">    </span><span class="p">|</span><span class="w"> </span>sed<span class="w"> </span>-e<span class="w"> </span><span class="s1">&#39;s/&gt;//g&#39;</span><span class="w"> </span>-e<span class="w"> </span><span class="s1">&#39;s/\.concoct_part_[0-9]*//g&#39;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="w">    </span><span class="p">|</span><span class="w"> </span>sort<span class="w"> </span>-u<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a><span class="w">    </span>&gt;<span class="w"> </span><span class="si">${</span><span class="nv">cluster</span><span class="p">/.fa/.contigID</span><span class="si">}</span>
<a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a><span class="k">done</span>
</code></pre></div>
</div>
<p>Then, we use SeqKit to extract the required contigs.</p>
<div class="admonition terminal">
<p class="admonition-title">code</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>module<span class="w"> </span>purge
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>module<span class="w"> </span>load<span class="w"> </span>SeqKit/2.4.0
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="k">for</span><span class="w"> </span>ids<span class="w"> </span><span class="k">in</span><span class="w"> </span>vb_export/cluster*.contigID<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="w">    </span>seqkit<span class="w"> </span>grep<span class="w"> </span>-f<span class="w"> </span><span class="si">${</span><span class="nv">ids</span><span class="si">}</span><span class="w"> </span>&lt;<span class="o">(</span>cat<span class="w"> </span>mock_bins/*.fna<span class="o">)</span><span class="w"> </span>&gt;<span class="w"> </span>refined_bins/<span class="k">$(</span>basename<span class="w"> </span><span class="si">${</span><span class="nv">ids</span><span class="si">}</span><span class="w"> </span>.contigID<span class="k">)</span>.fna
<a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a><span class="k">done</span>
</code></pre></div>
</div>
<details class="hint">
<summary>Refining by omission</summary>
<p>If you want to use the <code>vb_omit_contigs_tmp.txt</code> as the search pattern to omit contigs from the bins, you can do that following:</p>
<div class="admonition terminal">
<p class="admonition-title">code</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>module<span class="w"> </span>purge
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>module<span class="w"> </span>load<span class="w"> </span>SeqKit/2.4.0
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a>
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a><span class="k">for</span><span class="w"> </span>bins<span class="w"> </span><span class="k">in</span><span class="w"> </span>mock_bins/*.fna<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a><span class="w">    </span>seqkit<span class="w"> </span>grep<span class="w"> </span>-v<span class="w"> </span>-f<span class="w"> </span>vb_omit_contigs.tmp.txt<span class="w"> </span>&gt;<span class="w"> </span>refined_bins/<span class="k">$(</span>basename<span class="w"> </span><span class="si">${</span><span class="nv">bins</span><span class="si">}</span><span class="w"> </span>.fna<span class="k">)</span>.refined.fna
<a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a><span class="k">done</span>
</code></pre></div>
</div>
<p>In the code above, we added a <code>-v</code> to the <code>grep</code> command to indicate invert matches.</p>
</details>
<h3 id="check-your-new-bins">Check your new bins!<a class="headerlink" href="#check-your-new-bins" title="Permanent link">&para;</a></h3>
<p>Moment of truth! How did your decisions impact the genome metrics of the refined bins? Run your selections through CheckM and see how you did!</p>
<div class="admonition terminal">
<p class="admonition-title">code</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-18-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-18-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-18-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-18-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-18-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-18-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-18-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-18-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-18-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-18-10">10</a></span>
<span class="normal"><a href="#__codelineno-18-11">11</a></span>
<span class="normal"><a href="#__codelineno-18-12">12</a></span>
<span class="normal"><a href="#__codelineno-18-13">13</a></span>
<span class="normal"><a href="#__codelineno-18-14">14</a></span>
<span class="normal"><a href="#__codelineno-18-15">15</a></span>
<span class="normal"><a href="#__codelineno-18-16">16</a></span>
<span class="normal"><a href="#__codelineno-18-17">17</a></span>
<span class="normal"><a href="#__codelineno-18-18">18</a></span>
<span class="normal"><a href="#__codelineno-18-19">19</a></span>
<span class="normal"><a href="#__codelineno-18-20">20</a></span>
<span class="normal"><a href="#__codelineno-18-21">21</a></span>
<span class="normal"><a href="#__codelineno-18-22">22</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1"></a><span class="ch">#!/bin/bash -e</span>
<a id="__codelineno-18-2" name="__codelineno-18-2"></a><span class="c1">#SBATCH --account       nesi02659</span>
<a id="__codelineno-18-3" name="__codelineno-18-3"></a><span class="c1">#SBATCH --job-name      CheckM_vb_exports</span>
<a id="__codelineno-18-4" name="__codelineno-18-4"></a><span class="c1">#SBATCH --partition     milan</span>
<a id="__codelineno-18-5" name="__codelineno-18-5"></a><span class="c1">#SBATCH --time          00:20:00</span>
<a id="__codelineno-18-6" name="__codelineno-18-6"></a><span class="c1">#SBATCH --mem           50GB</span>
<a id="__codelineno-18-7" name="__codelineno-18-7"></a><span class="c1">#SBATCH --cpus-per-task 10</span>
<a id="__codelineno-18-8" name="__codelineno-18-8"></a><span class="c1">#SBATCH --error         %x_%j.err</span>
<a id="__codelineno-18-9" name="__codelineno-18-9"></a><span class="c1">#SBATCH --output        %x_%j.out</span>
<a id="__codelineno-18-10" name="__codelineno-18-10"></a>
<a id="__codelineno-18-11" name="__codelineno-18-11"></a><span class="c1"># Load modules</span>
<a id="__codelineno-18-12" name="__codelineno-18-12"></a>module<span class="w"> </span>purge
<a id="__codelineno-18-13" name="__codelineno-18-13"></a>module<span class="w"> </span>load<span class="w"> </span>CheckM/1.2.3-foss-2023a-Python-3.11.6
<a id="__codelineno-18-14" name="__codelineno-18-14"></a>
<a id="__codelineno-18-15" name="__codelineno-18-15"></a><span class="c1"># Working directory</span>
<a id="__codelineno-18-16" name="__codelineno-18-16"></a><span class="nb">cd</span><span class="w"> </span>/nesi/nobackup/nesi02659/MGSS_U/&lt;YOUR<span class="w"> </span>FOLDER&gt;/6.bin_refinement/
<a id="__codelineno-18-17" name="__codelineno-18-17"></a>
<a id="__codelineno-18-18" name="__codelineno-18-18"></a><span class="c1"># Run CheckM</span>
<a id="__codelineno-18-19" name="__codelineno-18-19"></a>checkm<span class="w"> </span>lineage_wf<span class="w"> </span>-t<span class="w"> </span><span class="nv">$SLURM_CPUS_PER_TASK</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-18-20" name="__codelineno-18-20"></a><span class="w">                  </span>--pplacer_threads<span class="w"> </span><span class="nv">$SLURM_CPUS_PER_TASK</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-18-21" name="__codelineno-18-21"></a><span class="w">                  </span>-x<span class="w"> </span>fna<span class="w"> </span>--tab_table<span class="w"> </span>-f<span class="w"> </span>refined_bins.checkm.txt<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-18-22" name="__codelineno-18-22"></a><span class="w">                  </span>refined_bins/<span class="w"> </span>refined_bins.checkm_out/
</code></pre></div></td></tr></table></div>
</div>
<h3 id="human-refinement-vs-automated-binning">Human refinement vs automated binning<a class="headerlink" href="#human-refinement-vs-automated-binning" title="Permanent link">&para;</a></h3>
<p>Did you do better than the automated binning software? Consider the following:</p>
<div class="admonition question">
<ul>
<li>Were the new clusters more complete?</li>
<li>How much contamination was removed?</li>
<li>Was there an substantial trade-off between completeness and contamination?</li>
<li>How would you pre-process the sequences differently prior to manual refinement?</li>
<li>Are there additional information that would have helped you in the decision-making process?</li>
</ul>
</div>
<p>When your CheckM run finishes, check and compare how you did!</p>
<!--
### Food for thought: bin diagnosis and refinement

Did you do better or worse? Which metrics improved and which deteriorated? What were some trade-offs 


## 2. Export potentially problematic contigs

### Select problematic contigs to examine

Zoom in,  make a selection of potentially problematic contigs, and export as above.

<center>
![image](../figures/ex10_select_outlier_2022.png){width="600"}
</center>

Try this for one or two problematic contigs (or subsets of contigs). In practice, you could repeat this for all potentially problematic contigs, saving each export as a new `contigs_n.fna` file.

!!! abstract "Note"

    For the subsequent step using `vizbin_count_table_2022.sh`, all exported cluster files must share a common prefix (e.g. `cluster...fna`), and all files of problematic contigs must also share a common prefix (e.g. `contigs...fna`).*

---
-->

<!--
## *(Optional)* Refining and filtering problematic contigs from bins

### Create a count table of counts of our problematic contigs across each bin

You'll recall that, prior running `VizBin`, the contigs in our bins were first cut into fragments to improve the density of the clusters in the *t-SNE* projection. As such, the problematic contigs we have exported from `VizBin` are *sub-contig* fragments, rather than full contigs from our bins. It is entirely possible that different fragments of the original contigs have been placed in different clusters during our `VizBin` analysis - including cases where most sub-contigs have clustered with the bin we expect, and a small number have been identified as "problematic" (i.e. clustered with other bins). Based on the information from these extracted problematic sub-contigs, we now have to carefully consider whether or not we want to remove the *full* contig from our bin data.

To do this, we will generate a table containing each exported "problematic" sub-contig, and counts of how many of its sister sub-contigs (each of the other sub-contig fragments derived from the same original parent contig) fall into each `VizBin` cluster.

For this exercise, a folder of the exported files from `VizBin` for all clusters (`cluster_[1-n].fna`) and problematic sub-contigs (`contigs_[1-n].fna`) has been provided at `vizbin_example_exports/`

We will input these files to the shell script `vizbin_count_table_2022.sh` to generate a count table of the exported subcontigs across each `VizBin` cluster (`vb_count_table.txt`), as well as a working list of contigs to potentially remove from our final bin data (`vb_omit_contigs_tmp.txt`).

For future reference, a copy of this script is available for download [here](https://github.com/GenomicsAotearoa/metagenomics_summer_school/tree/master/docs/scripts).

!!! terminal "code"

    <div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>./vizbin_count_table_2022.sh<span class="w"> </span>-i<span class="w"> </span>vizbin_example_exports/
</code></pre></div>

The only required input to `vizbin_count_table_2022.sh` is the path to the cluster and contigs files exported from `VizBin`. By default, the script looks for the prefix `cluster...` for the cluster file names, `contig...` for the files of problematic sub-contigs, and the file extension `.fna` for each. The arguments `-s <contig_file_prefix> -c <cluster_file_prefix> -e <fasta_file_extension>` can optionally be provided if your file name formats differ from the default.

View the output count table:

!!! terminal "code"

    <div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a>less<span class="w"> </span>vb_count_table.txt
</code></pre></div>

Example excerpt:

| Subcontig_ID| Subcontig_vb_cluster | cluster_1_count | cluster_2_count | cluster_3_count | cluster_4_count | cluster_5_count | Total_count |
| :- | :-: | :-: | :-: | :-: | :-: | :-: | :-: |
| >bin_3_NODE_81_length_109410_cov_1.136244.concoct_part_1 | cluster_5 | 0 | 0 | 0 | 4 | 1 | 5 |
| >bin_3_NODE_289_length_18049_cov_1.596107.concoct_part_0 | cluster_5 | 0 | 0 | 0 | 0 | 1 | 1 |
| >bin_3_NODE_349_length_12681_cov_1.204936.concoct_part_0 | cluster_5 | 0 | 0 | 0 | 0 | 1 | 1 |

Note that in the case of the first contig from the excerpt above, the 'problematic' contig is only one of 5 sub-contigs, and all other 4 sub-contigs are in the expected cluster. In this case, we likely do *not* want to remove this contig from the bin.

### Generate a list of contigs to *exclude* from filtering

Create a list of contigs identified from `vb_count_table.txt` that are *not* to be filtered out by seqmagick in the next step. For example, those contigs that have sub-contigs split across multiple `VizBin` clusters, and for which it's reasonable to actually keep the contig (such as when a flagged selected sub-contig exported from vizbin is in one unexpected cluster, but all other sub-contigs from that parent contig are in the expected cluster; in this case, you likely *don't* want to filter out the parent contig from the data set moving forward). 

Below is an example. Simply replace the contig IDs between the quotes for as many lines as necessary for your data. 

!!! note "Write/append outputs and extracting contig ID"

    1. The first line below must always have only one `>` character, while all subsequent lines must have two (i.e. `>>`) to append correctly to the list.
    2. We want the original contig ID here, *not* the sub-contig, so make sure to remove the `.concoct_part_n` fragment number at the end if there is one.

!!! terminal "code"

    <div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;bin_3_NODE_81_length_109410_cov_1.136244&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>vb_keep_contigs.txt
</code></pre></div>

### Create final `vb_omit_contigs_filtered.txt` list of contigs to filter from bins

Using `grep`, filter contigs we wish to keep (after assessing `vb_count_table.txt`) out of the working `vb_omit_contigs_tmp.txt` list. 

This creates `vb_omit_contigs_filtered.txt`, which we will then pass to `seqmagick` to filter these contigs out of our actual bin FASTA files.

!!! terminal "code"

    <div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a>grep<span class="w"> </span>-v<span class="w"> </span>-f<span class="w"> </span>vb_keep_contigs.txt<span class="w"> </span>vb_omit_contigs_tmp.txt<span class="w"> </span>&gt;<span class="w"> </span>vb_omit_contigs_filtered.txt
</code></pre></div>

### Filter suspect contigs (based on `VizBin` analysis) from the bin data

Use `seqmagick --exclude-from-file ...` to filter problematic contigs (those contigs listed in `vb_omit_contigs_filtered.txt`) out of the initial *unchopped* bin FASTA files, generating final bins for downstream processing.

!!! terminal "code"

    <div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a>mkdir<span class="w"> </span>filtered_bins/
<a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a>
<a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a><span class="c1"># Load seqmagick</span>
<a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a>module<span class="w"> </span>purge
<a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a>module<span class="w"> </span>load<span class="w"> </span>seqmagick/0.8.4-gimkl-2020a-Python-3.8.2
<a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a>
<a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a><span class="c1"># filter problematic contigs out of original bin files</span>
<a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a><span class="k">for</span><span class="w"> </span>bin_file<span class="w"> </span><span class="k">in</span><span class="w"> </span>example_data_unchopped/*.fna<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<a id="__codelineno-23-9" name="__codelineno-23-9" href="#__codelineno-23-9"></a><span class="w">    </span><span class="nv">bin_name</span><span class="o">=</span><span class="k">$(</span>basename<span class="w"> </span><span class="si">${</span><span class="nv">bin_file</span><span class="si">}</span><span class="w"> </span>.fna<span class="k">)</span>
<a id="__codelineno-23-10" name="__codelineno-23-10" href="#__codelineno-23-10"></a><span class="w">    </span>seqmagick<span class="w"> </span>convert<span class="w"> </span>--exclude-from-file<span class="w"> </span>vb_omit_contigs_filtered.txt<span class="w"> </span><span class="si">${</span><span class="nv">bin_file</span><span class="si">}</span><span class="w"> </span>filtered_bins/<span class="si">${</span><span class="nv">bin_name</span><span class="si">}</span>.filtered.fna
<a id="__codelineno-23-11" name="__codelineno-23-11" href="#__codelineno-23-11"></a><span class="k">done</span>
</code></pre></div>

Our filtered bins for downstream use are now in `filtered_bins/`

---

## *(Optional)* Comparing pre- and post-filtered bins via `CheckM`

The end goal of this process is the generation of a final set of refined bins. Following this, the `CheckM` procedure should be re-run, this time on the refined `filtered_bins/`. This provides `CheckM` metrics for the final actual (filtered) bin set, and also an opportunity to compare between pre- and post-filtering to see if the `VizBin` bin refinement steps have, for example, improved the degree of contamination in the bins.

For this exercise, a copy of the output from running `CheckM` on the `filtered_bins/` is available at `6.bin_refinement/filtered_bins_checkm.txt`. View the previous `CheckM` output and the filtered bins output to compare via `cat`.

!!! terminal "code"

    <div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a>cat<span class="w"> </span>filtered_bins_checkm.txt<span class="w"> </span>
</code></pre></div>

!!! circle-check "Content of `filtered_bins_checkm.txt`"

    | Bin Id | Marker lineage | # genomes | # markers | # marker sets | 0 | 1 | 2 | 3 | 4 | 5+ | Completeness | Contamination | Strain heterogeneity |
    | :- | :-: | :-: | :-: | :-: | :-: | :-: | :-: | :-: | :-: | :-: | :-: | :-: | :-: |
    | bin_0.filtered | k__Bacteria (UID3060) | 138 | 338 | 246 | 1 | 327 | 9 | 1 | 0 | 0 | 99.59 | 3.79 | 0.00 |
    | bin_1.filtered | k__Bacteria (UID3060) | 138 | 338 | 246 | 1 | 336 | 1 | 0 | 0 | 0 | 99.59 | 0.41 | 0.00 |
    | bin_2.filtered | g__Staphylococcus (UID301) | 45 | 940 | 178 | 20 | 918 | 2 | 0 | 0 | 0 | 98.32 | 0.11 | 0.00 |
    | bin_3.filtered | c__Betaproteobacteria (UID3959) | 235 | 414 | 211 | 1 | 408 | 5 | 0 | 0 | 0 | 99.97 | 0.90 | 0.00 |
    | bin_4.filtered | c__Deltaproteobacteria (UID3218) | 61 | 284 | 169 | 10 | 274 | 0 | 0 | 0 | 0 | 94.08 | 0.00 | 0.00 |
    | bin_5.filtered | o__Pseudomonadales (UID4488) | 185 | 813 | 308 | 25 | 787 | 1 | 0 | 0 | 0 | 96.87 | 0.11 | 0.00 |
    | bin_6.filtered | k__Bacteria (UID2565) | 2921 | 149 | 91 | 11 | 136 | 2 | 0 | 0 | 0 | 90.66 | 0.61 | 0.00 |
    | bin_7.filtered | p__Cyanobacteria (UID2143) | 129 | 471 | 367 | 0 | 470 | 1 | 0 | 0 | 0 | 100.00 | 0.14 | 0.00 |
    | bin_8.filtered | f__Bradyrhizobiaceae (UID3695) | 47 | 693 | 296 | 3 | 690 | 0 | 0 | 0 | 0 | 99.47 | 0.00 | 0.00 |
    | bin_9.filtered | g__Vibrio (UID4878) | 67 | 1130 | 369 | 4 | 1125 | 1 | 0 | 0 | 0 | 99.46 | 0.03 | 0.00 |

!!! terminal "code"

    <div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a>cat<span class="w"> </span>../5.binning/checkm.txt<span class="w"> </span>
</code></pre></div>

!!! circle-check "Content of `checkm.txt`"

    | Bin Id | Marker lineage | # genomes | # markers | # marker sets | 0 | 1 | 2 | 3 | 4 | 5+ | Completeness | Contamination | Strain heterogeneity |
    | :- | :-: | :-: | :-: | :-: | :-: | :-: | :-: | :-: | :-: | :-: | :-: | :-: | :-: |
    | maxbin.001.fasta | k__Bacteria (UID3060) | 138 | 338 | 246 | 1 | 327 | 9 | 1 | 0 | 0 | 99.59 | 3.79 | 0.00 |
    | maxbin.002.fasta | k__Bacteria (UID3060) | 138 | 338 | 246 | 1 | 336 | 1 | 0 | 0 | 0 | 99.59 | 0.41 | 0.00 |
    | metabat.10_sub | g__Staphylococcus (UID301) | 45 | 940 | 178 | 20 | 918 | 2 | 0 | 0 | 0 | 98.32 | 0.11 | 0.00 |
    | metabat.11 | c__Betaproteobacteria (UID3959) | 235 | 414 | 211 | 1 | 408 | 5 | 0 | 0 | 0 | 99.97 | 0.90 | 0.00 |
    | metabat.12 | c__Deltaproteobacteria (UID3218) | 61 | 284 | 169 | 10 | 274 | 0 | 0 | 0 | 0 | 94.08 | 0.00 | 0.00 |
    | metabat.2 | o__Pseudomonadales (UID4488) | 185 | 813 | 308 | 25 | 787 | 1 | 0 | 0 | 0 | 96.87 | 0.11 | 0.00 |
    | metabat.3_sub | k__Bacteria (UID2565) | 2921 | 149 | 91 | 11 | 136 | 2 | 0 | 0 | 0 | 90.66 | 0.61 | 0.00 |
    | metabat.4 | p__Cyanobacteria (UID2143) | 129 | 471 | 367 | 0 | 470 | 1 | 0 | 0 | 0 | 100.00 | 0.14 | 0.00 |
    | metabat.5 | f__Bradyrhizobiaceae (UID3695) | 47 | 693 | 296 | 3 | 690 | 0 | 0 | 0 | 0 | 99.47 | 0.00 | 0.00 |
    | metabat.7 | g__Vibrio (UID4878) | 67 | 1130 | 369 | 4 | 1125 | 1 | 0 | 0 | 0 | 99.46 | 0.03 | 0.00 |

An example of an updated slurm script to run `CheckM` on the `filtered_bins/` is as follows:

!!! terminal "code"

    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-26-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-26-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-26-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-26-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-26-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-26-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-26-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-26-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-26-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-26-10">10</a></span>
<span class="normal"><a href="#__codelineno-26-11">11</a></span>
<span class="normal"><a href="#__codelineno-26-12">12</a></span>
<span class="normal"><a href="#__codelineno-26-13">13</a></span>
<span class="normal"><a href="#__codelineno-26-14">14</a></span>
<span class="normal"><a href="#__codelineno-26-15">15</a></span>
<span class="normal"><a href="#__codelineno-26-16">16</a></span>
<span class="normal"><a href="#__codelineno-26-17">17</a></span>
<span class="normal"><a href="#__codelineno-26-18">18</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1"></a><span class="ch">#!/bin/bash -e</span>
<a id="__codelineno-26-2" name="__codelineno-26-2"></a><span class="c1">#SBATCH --account       nesi02659</span>
<a id="__codelineno-26-3" name="__codelineno-26-3"></a><span class="c1">#SBATCH --job-name      checkm_refined_bins</span>
<a id="__codelineno-26-4" name="__codelineno-26-4"></a><span class="c1">#SBATCH --partition     milan</span>
<a id="__codelineno-26-5" name="__codelineno-26-5"></a><span class="c1">#SBATCH --time          00:20:00</span>
<a id="__codelineno-26-6" name="__codelineno-26-6"></a><span class="c1">#SBATCH --mem           50GB</span>
<a id="__codelineno-26-7" name="__codelineno-26-7"></a><span class="c1">#SBATCH --cpus-per-task 10</span>
<a id="__codelineno-26-8" name="__codelineno-26-8"></a><span class="c1">#SBATCH --error         %x_%j.err</span>
<a id="__codelineno-26-9" name="__codelineno-26-9"></a><span class="c1">#SBATCH --output        %x_%j.out</span>
<a id="__codelineno-26-10" name="__codelineno-26-10"></a>
<a id="__codelineno-26-11" name="__codelineno-26-11"></a>module<span class="w"> </span>purge
<a id="__codelineno-26-12" name="__codelineno-26-12"></a>module<span class="w"> </span>load<span class="w"> </span>CheckM/1.2.3-foss-2023a-Python-3.11.6
<a id="__codelineno-26-13" name="__codelineno-26-13"></a>
<a id="__codelineno-26-14" name="__codelineno-26-14"></a><span class="nb">cd</span><span class="w"> </span>/nesi/nobackup/nesi02659/MGSS_U/&lt;YOUR<span class="w"> </span>FOLDER&gt;/6.bin_refinement/
<a id="__codelineno-26-15" name="__codelineno-26-15"></a>
<a id="__codelineno-26-16" name="__codelineno-26-16"></a>checkm<span class="w"> </span>lineage_wf<span class="w"> </span>-t<span class="w"> </span><span class="nv">$SLURM_CPUS_PER_TASK</span><span class="w"> </span>--pplacer_threads<span class="w"> </span><span class="nv">$SLURM_CPUS_PER_TASK</span><span class="w"> </span>-x<span class="w"> </span>fna<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-26-17" name="__codelineno-26-17"></a><span class="w">                  </span>--tab_table<span class="w"> </span>-f<span class="w"> </span>filtered_bins_checkm.txt<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-26-18" name="__codelineno-26-18"></a><span class="w">                  </span>filtered_bins/<span class="w"> </span>filtered_bins_checkm_out/
</code></pre></div></td></tr></table></div>

The data you have been working with was created using the `cut_up_fasta.py` script that comes with the binning tool `CONCOCT`. It was run to cut contigs into 20k fragments, to better add density to the cluster. If you would like to visualise the data using different contig fragment sizes, you can create these using the following commands (replace `YOUR_CONTIG_SIZE` with the size of interest, e.g. `10000`):

!!! terminal "code"

    <div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a>module<span class="w"> </span>purge
<a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a>module<span class="w"> </span>load<span class="w"> </span>CONCOCT/1.0.0-gimkl-2018b-Python-2.7.16
<a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a>
<a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a>mkdir<span class="w"> </span>custom_chop/
<a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a>
<a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a><span class="c1"># Fragment contigs within each bin, outputting to custom_chop/</span>
<a id="__codelineno-27-7" name="__codelineno-27-7" href="#__codelineno-27-7"></a><span class="k">for</span><span class="w"> </span>bin_file<span class="w"> </span><span class="k">in</span><span class="w"> </span>example_data_unchopped/*<span class="p">;</span>
<a id="__codelineno-27-8" name="__codelineno-27-8" href="#__codelineno-27-8"></a><span class="k">do</span>
<a id="__codelineno-27-9" name="__codelineno-27-9" href="#__codelineno-27-9"></a><span class="w">    </span><span class="nv">bin_name</span><span class="o">=</span><span class="k">$(</span>basename<span class="w"> </span><span class="si">${</span><span class="nv">bin_file</span><span class="si">}</span><span class="w"> </span>.fna<span class="k">)</span>
<a id="__codelineno-27-10" name="__codelineno-27-10" href="#__codelineno-27-10"></a><span class="w">    </span>cut_up_fasta.py<span class="w"> </span>-c<span class="w"> </span>YOUR_CONTIG_SIZE<span class="w"> </span>-o<span class="w"> </span><span class="m">0</span><span class="w"> </span>--merge_last<span class="w"> </span><span class="si">${</span><span class="nv">bin_file</span><span class="si">}</span><span class="w"> </span>&gt;<span class="w"> </span>custom_chop/<span class="si">${</span><span class="nv">bin_name</span><span class="si">}</span>.chopped.fna
<a id="__codelineno-27-11" name="__codelineno-27-11" href="#__codelineno-27-11"></a><span class="k">done</span>
<a id="__codelineno-27-12" name="__codelineno-27-12" href="#__codelineno-27-12"></a>
<a id="__codelineno-27-13" name="__codelineno-27-13" href="#__codelineno-27-13"></a><span class="c1"># Concatenate the chopped bins into single .fna</span>
<a id="__codelineno-27-14" name="__codelineno-27-14" href="#__codelineno-27-14"></a>cat<span class="w"> </span>custom_chop/*.fna<span class="w"> </span>&gt;<span class="w"> </span>all_bins_custom_chop.fna
</code></pre></div>

You can open `all_bins_custom_chop.fna` in `VizBin` to view the clustering with this new fragmentation threshold. 

If you wish to also provide an annotation file to colour by bin, this can be generated with the following:

!!! terminal "code"

    <div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="c1"># Set up annotation file headers</span>
<a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;label&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>custom_chop.vizbin.ann
<a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a>
<a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a><span class="c1"># loop through custom_chop .fna files</span>
<a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a><span class="k">for</span><span class="w"> </span>bin_file<span class="w"> </span><span class="k">in</span><span class="w"> </span>custom_chop/*.fna<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<a id="__codelineno-28-6" name="__codelineno-28-6" href="#__codelineno-28-6"></a><span class="w">    </span><span class="c1"># extract bin ID</span>
<a id="__codelineno-28-7" name="__codelineno-28-7" href="#__codelineno-28-7"></a><span class="w">    </span><span class="nv">binID</span><span class="o">=</span><span class="k">$(</span>basename<span class="w"> </span><span class="si">${</span><span class="nv">bin_file</span><span class="si">}</span><span class="w"> </span>.fna<span class="k">)</span>
<a id="__codelineno-28-8" name="__codelineno-28-8" href="#__codelineno-28-8"></a><span class="w">    </span><span class="c1"># loop through each sequence header in bin_file, adding binID to custom_chop.vizbin.ann for each header present</span>
<a id="__codelineno-28-9" name="__codelineno-28-9" href="#__codelineno-28-9"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span>header<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="sb">`</span>grep<span class="w"> </span><span class="s2">&quot;&gt;&quot;</span><span class="w"> </span><span class="si">${</span><span class="nv">bin_file</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<a id="__codelineno-28-10" name="__codelineno-28-10" href="#__codelineno-28-10"></a><span class="w">        </span><span class="c1"># Add binID to vizbin.ann for each header present</span>
<a id="__codelineno-28-11" name="__codelineno-28-11" href="#__codelineno-28-11"></a><span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">binID</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>custom_chop.vizbin.ann
<a id="__codelineno-28-12" name="__codelineno-28-12" href="#__codelineno-28-12"></a><span class="w">    </span><span class="k">done</span>
<a id="__codelineno-28-13" name="__codelineno-28-13" href="#__codelineno-28-13"></a><span class="k">done</span>
</code></pre></div>

If you wish to generate the full annotation file, including coverage and length values, you will need to go through the process outlined in the [Appendix for this exercise](../resources/2_APPENDIX_ex9_Generating_input_files_for_VizBin.md).  

---

## *(Optional)* Scripts for processing data with *ESOMana*

A suite of tools for creating input files for `ESOMana` can be found on github [here](https://github.com/tetramerFreqs/Binning).

The tool `ESOMana` can be downloaded from [SourceForge](http://databionic-esom.sourceforge.net/).

---
-->












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tracking", "navigation.sections", "navigation.expand", "navigation.top", "navigation.tabs", "navigation.tabs.sticky", "content.code.copy", "content.code.annotate"], "search": "../../assets/javascripts/workers/search.07f07601.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.56dfad97.min.js"></script>
      
        <script src="../../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  <script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body>
</html>